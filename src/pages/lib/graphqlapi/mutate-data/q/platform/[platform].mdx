export const meta = {
  title: `Create, update, and delete application data`,
  description: `Learn more about how to create and update data using GraphQL APIs in Amplify`
};

import guide from "/src/fragments/common/guide-header.mdx";

<Fragments fragments={{all: guide}} />

In this guide, you will learn how to use functions to create, read, update, and delete your data using the Amplify GraphQL client.

Before you begin, you will need:
- An application connected to the API

## Run mutations to create, update, and delete application data
  
In GraphQL, mutations write data to the API and are used to create, update, or delete data. This is different than queries that allow you to read the data but not change it. What follows are some examples of how you can create, update, and delete items using the Amplify GraphQL client.

### Create an item

<InlineFilter filters={["js", "react-native"]}>

You can create an item by first importing the API and mutations. Then you can add an item:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { API } from "aws-amplify";
import * as mutations from './graphql/mutations';
import { GraphQLQuery } from '@aws-amplify/api';
import { CreateTodoInput, CreateTodoMutation } from './API';

const todoDetails: CreateTodoInput = {
  name: 'Todo 1',
  description: 'Learn AWS AppSync'
};

const newTodo = await API.graphql<GraphQLQuery<CreateTodoMutation>>({ 
  query: mutations.createTodo, 
  variables: { input: todoDetails }
});
```

You should see the item created: `Learn AWS AppSync`.

</Block>

<Block name="JavaScript">

```js
import { API } from "aws-amplify";
import * as mutations from './graphql/mutations';

const todoDetails = {
  name: 'Todo 1',
  description: 'Learn AWS AppSync'
};

const newTodo = await API.graphql({ 
  query: mutations.createTodo, 
  variables: { input: todoDetails }
});
```

You should see the item created: `Learn AWS AppSync`.

</Block>

</BlockSwitcher>

<Callout>

__Note:__ You do not have to pass in the `createdAt` field. AWS AppSync manages this for you.

</Callout>

You can also import the `graphqlOperation` helper function to help you construct the argument object:

<BlockSwitcher>
<Block name="TypeScript">

```ts
// ...
import { API, graphqlOperation } from 'aws-amplify';

// equivalent to above example
const newTodo = await API.graphql<GraphQLQuery<CreateTodoMutation>>(
  graphqlOperation(mutations.createTodo, { input: todoDetails })
);
```

</Block>

<Block name="JavaScript">

```js
// ...
import { API, graphqlOperation } from 'aws-amplify';

// equivalent to above example
const newTodo = await API.graphql(
  graphqlOperation(mutations.createTodo, { input: todoDetails })
);
```

</Block>
</BlockSwitcher>

</InlineFilter>

<InlineFilter filters={["ios"]}>

You can run a GraphQL mutation with `Amplify.API.mutate` to create an item.

<BlockSwitcher>

<Block name="Async/Await">

Make sure you have the following imports at the top of your file:

```swift
import Amplify
```

```swift
func createTodo() async {
    // Retrieve your Todo using Amplify.API.query
    var todo = Todo(name: "my first todo", description: "todo description")
    todo.description = "created description"
    do {
        let result = try await Amplify.API.mutate(request: .create(todo))
        switch result {
        case .success(let todo):
            print("Successfully created todo: \(todo)")
        case .failure(let error):
            print("Got failed result with \(error.errorDescription)")
        }
    } catch let error as APIError {
        print("Failed to create todo: ", error)
    } catch {
        print("Unexpected error: \(error)")
    }
}
```
</Block>

<Block name="Combine">

You can run a GraphQL mutation with `Amplify.API.mutate`. Make sure you have the following imports at the top of your file:

```swift
import Amplify
import Combine
```

```swift
func createTodo() -> AnyCancellable {
    // Retrieve your Todo using Amplify.API.query
    var todo = Todo(name: "my first todo", description: "todo description")
    todo.description = "created description"
    let todoCreated = todo
    let sink = Amplify.Publisher.create {
        try await Amplify.API.mutate(request: .create(todoCreated))
    }
    .sink {
        if case let .failure(error) = $0 {
            print("Got failed event with error \(error)")
        }
    }
    receiveValue: { result in
        switch result {
        case .success(let todo):
            print("Successfully created todo: \(todo)")
        case .failure(let error):
            print("Got failed result with \(error.errorDescription)")
        }
    }
    return sink
}
```

</Block>

</BlockSwitcher>

</InlineFilter>

<InlineFilter filters={["android"]}>

Now that the client is set up, you can run a GraphQL mutation with `Amplify.API.mutate` to create your data.

<BlockSwitcher>
<Block name="Java">

```java
Todo todo = Todo.builder()
    .name("My todo")
    .build();

Amplify.API.mutate(ModelMutation.create(todo),
    response -> Log.i("MyAmplifyApp", "Todo with id: " + response.getData().getId()),
    error -> Log.e("MyAmplifyApp", "Create failed", error)
);
```

</Block>
<Block name="Kotlin - Callbacks">

```kotlin
val todo = Todo.builder()
    .name("My todo")
    .build()

Amplify.API.mutate(ModelMutation.create(todo),
    { Log.i("MyAmplifyApp", "Todo with id: ${it.data.id}") }
    { Log.e("MyAmplifyApp", "Create failed", it) }
)
```

</Block>
<Block name="Kotlin - Coroutines">

```kotlin
val todo = Todo.builder()
    .name("My todo")
    .build()
try {
    val response = Amplify.API.mutate(ModelMutation.create(todo))
    Log.i("MyAmplifyApp", "Todo with id: ${response.data.id}")
} catch (error: ApiException) {
    Log.e("MyAmplifyApp", "Create failed", error)
}
```

</Block>
<Block name="RxJava">

```java
Todo todo = Todo.builder()
        .name("My todo")
        .build();

RxAmplify.API.mutate(ModelMutation.create(todo))
        .subscribe(
            response -> Log.i("MyAmplifyApp", "Todo with id: " + response.getData().getId()),
            error -> Log.e("MyAmplifyApp", "Create failed", error)
        );
```

</Block>
</BlockSwitcher>

</InlineFilter>

<InlineFilter filters={["flutter"]}>

You can run a GraphQL mutation with `Amplify.API.mutate` to create your data.

```dart
Future<void> createTodo() async {
  try {
    final todo = Todo(name: 'my first todo', description: 'todo description');
    final request = ModelMutations.create(todo);
    final response = await Amplify.API.mutate(request: request).response;

    final createdTodo = response.data;
    if (createdTodo == null) {
      safePrint('errors: ${response.errors}');
      return;
    }
    safePrint('Mutation result: ${createdTodo.name}');
  } on ApiException catch (e) {
    safePrint('Mutation failed: $e');
  }
}
```

</InlineFilter>

### Update an item

<InlineFilter filters={["js", "react-native"]}>

To update the item, use the GraphQL update mutation:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { API } from "aws-amplify";
import * as mutations from './graphql/mutations';
import { GraphQLQuery } from '@aws-amplify/api';
import { UpdateTodoInput, UpdateTodoMutation } from './API';

const todoDetails: UpdateTodoInput = {
  id: 'some_id',
  description: 'Updated description'
};

const updatedTodo = await API.graphql<GraphQLQuery<UpdateTodoMutation>>({ 
  query: mutations.updateTodo, 
  variables: { input: todoDetails }
});
```

</Block>

<Block name="JavaScript">

```js
import { API } from "aws-amplify";
import * as mutations from './graphql/mutations';

const todoDetails = {
  id: 'some_id',
//  _version: 'current_version', // add the "_version" field if your AppSync API has conflict detection (required for DataStore) enabled
  description: 'Updated description'
};

const updatedTodo = await API.graphql({ 
  query: mutations.updateTodo, 
  variables: { input: todoDetails }
});
```

</Block>

</BlockSwitcher>

<Callout>

__Notes:__

- You do not have to pass in the `updatedAt` field. AWS AppSync manages this for you.
- If you pass in *extra* input fields not expected by the AWS AppSync schema, this query will fail. You can see this in the `error` field returned by the query. In GraphQL, errors are not thrown like exceptions in other languages. Instead, any errors are captured and returned as part of the query result in the `error` field.

</Callout>

</InlineFilter>

<InlineFilter filters={["ios"]}>

To update data, replace the request with `.update`.

```swift
try await Amplify.API.mutate(request: .create(todo))
```

</InlineFilter>

<InlineFilter filters={["android"]}>

To update data, use `ModelMutation.update(todo)` instead.

</InlineFilter>

<InlineFilter filters={["flutter"]}>

To update the `Todo` with a new name:

```dart
Future<void> updateTodo(Todo originalTodo) async {
  final todoWithNewName = originalTodo.copyWith(name: 'new name');

  final request = ModelMutations.update(todoWithNewName);
  final response = await Amplify.API.mutate(request: request).response;
  safePrint('Response: $response');
}
```

</InlineFilter>

### Delete an item

<InlineFilter filters={["js", "react-native"]}>

You can then delete the Todo by using the delete mutation. Only an `id` is needed to identify which item to delete:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { API } from "aws-amplify";
import * as mutations from './graphql/mutations';
import { GraphQLQuery } from '@aws-amplify/api';
import { DeleteTodoInput, DeleteTodoMutation } from './API';

const todoDetails: DeleteTodoInput = {
  id: 'some_id',
};

const deletedTodo = await API.graphql<GraphQLQuery<DeleteTodoMutation>>({ 
  query: mutations.deleteTodo, 
  variables: { input: todoDetails }
});
```

</Block>

<Block name="JavaScript">

```js
import { API } from "aws-amplify";
import * as mutations from './graphql/mutations';

const todoDetails = {
  id: 'some_id',
};

const deletedTodo = await API.graphql({ 
  query: mutations.deleteTodo, 
  variables: { input: todoDetails }
});
```

</Block>

</BlockSwitcher>

<Callout>

__Note:__ Join table records must be deleted prior to deleting the associated records. For example, for a many-to-many relationship between Posts and Tags, delete the PostTags join record prior to deleting a Post or Tag.

</Callout>

<Accordion title='Custom authorization mode to mutate data' headingLevel='4' eyebrow='Learn more'>

Each AWS AppSync API uses a default authorization mode when you configure your app. If you get unauthorized errors you may need to update your authorization mode. To override this default, pass an `authMode` property. The following examples show how you can mutate data with custom authorization mode:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { API } from "aws-amplify";
import { GraphQLQuery, GRAPHQL_AUTH_MODE } from '@aws-amplify/api';
import * as mutations from './graphql/mutations';
import { CreateTodoInput, CreateTodoMutation } from './API';

const todoDetails: CreateTodoInput = {
  id: 'some_id',
  name: 'My todo!',
  description: 'Hello world!'
};

const todo = await API.graphql<GraphQLQuery<CreateTodoMutation>>({
  query: mutations.createTodo,
  variables: { input: todoDetails },
  authMode: GRAPHQL_AUTH_MODE.AWS_IAM
});
```

</Block>

<Block name="JavaScript">

```js
import { API } from "aws-amplify";
import { GRAPHQL_AUTH_MODE } from '@aws-amplify/api';
import * as mutations from './graphql/mutations';

const todoDetails = {
  id: 'some_id',
  name: 'My todo!',
  description: 'Hello world!'
};

const todo = await API.graphql({
  query: mutations.createTodo,
  variables: { input: todoDetails },
  authMode: GRAPHQL_AUTH_MODE.AWS_IAM
});
```

</Block>
</BlockSwitcher>

</Accordion>

</InlineFilter>

<InlineFilter filters={["ios"]}>

To delete data, replace the request with `.delete`.

```swift
try await Amplify.API.mutate(request: .delete(todo))
```

</InlineFilter>

<InlineFilter filters={["android"]}>

To delete data, use `ModelMutation.delete(todo)`.

</InlineFilter>

<InlineFilter filters={["flutter"]}>

To delete the `Todo`:

```dart
Future<void> deleteTodo(Todo todoToDelete) async {
  final request = ModelMutations.delete(todoToDelete);
  final response = await Amplify.API.mutate(request: request).response;
  safePrint('Response: $response');
}
```

Or you can delete by ID which is ideal if you do not have the instance in memory yet:

```dart
Future<void> deleteTodoById(Todo todoToDelete) async {
  final request = ModelMutations.deleteById(
    Todo.classType,
    TodoModelIdentifier(id: '8e0dd2fc-2f4a-4dc4-b47f-2052eda10775'),
  );
  final response = await Amplify.API.mutate(request: request).response;
  safePrint('Response: $response');
}
```

</InlineFilter>

<InlineFilter filters={["js", "react-native"]}>

## Cancel mutation requests

You can cancel any GraphQL API request calling `.cancel` on the GraphQL request promise that's returned by `API.graphql(...)`.

```javascript
const promise = API.graphql(graphqlOperation(...));

try {
  await promise;
} catch (error) {
  console.log(error);
  // If the error is because the request was cancelled you can confirm here.
  if (API.isCancel(error)) {
    console.log(error.message); // "my message for cancellation"
    // handle user cancellation logic
  }
}

...

// To cancel the above request
API.cancel(promise, "my message for cancellation");
```

You need to ensure that the promise returned from `API.graphql()` has not been modified. Typically, async functions wrap the promise being returned into another promise. For example, the following will not work:

```javascript
async function makeAPICall() {
  return API.graphql(graphqlOperation(...));
}
const promise = makeAPICall();

// The following will NOT cancel the request.
API.cancel(promise, "my error message");
```

</InlineFilter>

## Conclusion

Congratulations! You have finished the **Create, update, and delete application data** guide. In this guide, you created, updated, and deleted your app data via the GraphQL API.

## Next steps

Our recommended next steps include using the API to query data and subscribe to real-time events to look for mutations in your data. Some resources that will help with this work include:

<InlineFilter filters={["js", "react-native"]}>

- [Read application data](https://docs.amplify.aws/lib/graphqlapi/query-data/q/platform/js/)
- [Subscribe to real-time events](https://docs.amplify.aws/lib/graphqlapi/subscribe-data/q/platform/js/)

</InlineFilter>

<InlineFilter filters={["ios"]}>

- [Read application data](https://docs.amplify.aws/lib/graphqlapi/query-data/q/platform/ios/)
- [Subscribe to real-time events](https://docs.amplify.aws/lib/graphqlapi/subscribe-data/q/platform/ios/)

</InlineFilter>

<InlineFilter filters={["android"]}>

- [Read application data](https://docs.amplify.aws/lib/graphqlapi/query-data/q/platform/android/)
- [Subscribe to real-time events](https://docs.amplify.aws/lib/graphqlapi/subscribe-data/q/platform/android/)

</InlineFilter>

<InlineFilter filters={["flutter"]}>

- [Read application data](https://docs.amplify.aws/lib/graphqlapi/query-data/q/platform/flutter/)
- [Subscribe to real-time events](https://docs.amplify.aws/lib/graphqlapi/subscribe-data/q/platform/flutter/)

</InlineFilter>