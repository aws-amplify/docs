export const meta = {
  title: 'Setup AWS account',
  description: 'Learn how to configure your account to work with Amplify.'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };

}

## Configure local machine

To setup the Amplify Sandbox environment on your local machine, you have to configure it to connect to your AWS account.

## Pre-requisites for installation

- [Install Node.js®](https://nodejs.org/en/download/) and [NPM](https://www.npmjs.com/get-npm) if they are not already on your machine.
- Verify that you are running at least Node.js version 12.x and npm version 6.x or greater by running `node -v` and `npm -v` in a terminal/console window
- [Create AWS Account](https://portal.aws.amazon.com/billing/signup?redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start). If you don't already have an AWS account, you'll need to create one in order to follow the steps outlined in this tutorial.
- For Apple Silicon Macs, if you don’t already have Rosetta installed, install using `softwareupdate --install-rosetta`.

## Setup a local profile

### If you do not have an IAM user and credentials setup

> If you already have an AWS profile with credentials on your machine, you can skip this step.

Configure a profile by running the following command:
```bash
amplify configure profile --name <value>
```

`amplify configure profile` will ask you if you already have setup IAM user credentials. Enter `No`.

To setup an IAM user and credentials, follow the instructions outlined below:

> Amazon IAM (Identity and Access Management) enables you to manage users and user permissions in AWS. You can learn more about Amazon IAM [here](https://aws.amazon.com/iam/).

- Sign into the [AWS Management Console](https://console.aws.amazon.com/). 
- Navigate to the [IAM User creation page](https://console.aws.amazon.com/iamv2/home#/users/create).
- Enter a User name and select **Next**. You can name the user anything but we'll call it "amplify-dev".

![](src/public/images/gen2/user1.png)

Select **Attach policies directly** and select **AmplifyBackendDeployFullAccess** as the Permissions policy. Select **Next**.

![](src/public/images/gen2/user2.png)

On the Review page, check that everything looks good and select **Create user**.

![](src/public/images/gen2/user3.png)

This will redirect to the users list page. Select the user you just created.

![](src/public/images/gen2/user4.png)

On the user details page, navigate to the **Security credentials** tab, scroll down to **Access keys** and select **Create access keys**.

![](src/public/images/gen2/user5.png)

On the next page, select **Command Line Interface**, acknowledge the warning, and select **Next**.

![](src/public/images/gen2/user6.png)

On the next page select **Create access key**. You’ll then see a page with the access keys for the user. Use the copy icon to copy these values to your clipboard, then return to the CLI.

![](src/public/images/gen2/user7.png)

Next, enter the credentials of the newly created IAM user i.e. their access key, secret access key, and lastly select the AWS region to use with the profile.

![](src/public/images/gen2/profile1.png)

### If you already have an IAM user and credentials setup

Configure a profile by running the following command:
```bash
amplify configure profile --name <value>
```

`amplify configure profile` will ask you if you already have setup IAM user credentials. Enter `Yes`.

Next, enter the credentials of the existing IAM user i.e. their access key and secret access key, and lastly select the AWS region to use with the profile.

![](src/public/images/gen2/profile2.png)

<Accordion title="SSO support">
  AWS Amplify (Gen 2) enhances your user experience with Single Sign-On (SSO) authentication powered by AWS IAM Identity Center. AWS Amplify Gen 2 now adheres to and works out of the box with the default [credential provider chain](https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/setting-credentials-node.html#credchain). You can get started with implementing SSO with the AWS CLI for your teams or organizations by referring to the [AWS IAM Identity Center documentation](https://docs.aws.amazon.com/sdkref/latest/guide/feature-sso-credentials.html).
</Accordion>

## Configure Amplify CI/CD

Before you can start creating the cloud sandbox environment, Amplify will need to complete a one-time bootstrap setup for the account and region before it can start deploying resources in your AWS account.

<Accordion title="What is bootstrapping?">
  Bootstrapping is the process of provisioning resources for the AWS CDK before you can deploy AWS CDK apps into an AWS environment. These resources include an Amazon S3 bucket for storing files and IAM roles that grant permissions needed to perform deployments. The required resources are defined in an AWS CloudFormation stack, called the bootstrap stack, which is usually named CDKToolkit. Like any AWS CloudFormation stack, it appears in the AWS CloudFormation console once it has been deployed. You can learn more about this process in the [CDK documentation](https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping.html).
</Accordion>

You can setup a distinct profile for each developer on your team and they can now start developing their fullstack applications locally by creating an isolated sandbox environment as follows:
```bash
amplify sandbox --profile <value>
```

![](src/public/images/gen2/profile4.png)

During the first time setup, `amplify sandbox` will ask you to sign into the AWS Console. Once you're signed in, you will be redirected to the Amplify Console. Select **Initialize setup now**, it may take a few minutes for the bootstrapping process to complete.

![](src/public/images/gen2/profile5.png)

![](src/public/images/gen2/profile6.png)

![](src/public/images/gen2/profile7.png)

Done! You have successfully completed the bootstrapping process and you can now return to the terminal to create a new Amplify Sandbox environment:

```bash
amplify sandbox --profile name
```
