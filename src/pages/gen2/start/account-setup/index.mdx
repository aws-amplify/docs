export const meta = {
  title: 'Set up your AWS account',
  description: 'Learn how to set up your AWS account and configure it locally for use with Amplify'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };
}

{/* "...configure an AWS profile locally for use with Amplify" -> `amplify configure profile` */}
This guide will walk you through how to set up your AWS account and configure an AWS profile locally for use with Amplify. Before getting started it is important to know there are a few options for authenticating with AWS. Using [AWS Identity and Access Management (IAM)](https://aws.amazon.com/iam/), you can configure either:

- permanent credentials with an [IAM user](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html) through the use of access keys
- temporary credentials with an [IAM role](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html)
- temporary credentials with [IAM Identity Center](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html), which is formerly known as AWS Single Sign-On (SSO)

Temporary credentials are an alternative to their permanent counterpart and enable you to define permissions for the _session_. Sessions are created when you [_assume_ an IAM role](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use.html) or sign in using AWS IAM Identity Center. These sessions come with an additional "session token" that is used to validate the temporary credentials and must be included on requests to AWS. As you are working locally, this will be presented as an additional environment variable.

> You can use temporary security credentials to make programmatic requests for AWS resources using the AWS CLI or AWS API (using the AWS SDKs). The temporary credentials provide the same permissions as long-term security credentials, such as IAM user credentials. However, there are a few differences:...
>
> [AWS Identity and Access Management documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html)

In general, though, credentials are typically resolved through the use of [AWS profiles](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html#cli-configure-files-using-profiles). Profiles can contain permanent credentials or SSO metadata, and can be set for use with Amplify by using the same techniques as the AWS CLI:

- with the `--profile` flag
- with the `AWS_PROFILE` environment variable

<Callout info>

**Note**: If you already have an AWS account and profile configured locally, you can skip this guide and specify a profile using one of the methods noted above.

</Callout>

## Configure an IAM user

To get started configuring an AWS profile with an IAM user and permanent credentials, run the following command:

```bash
npx amplify configure profile --name <value>
```

This command will ask you if you have already configured IAM user credentials. Enter `No`. To set up an IAM user and with permanent credentials, follow the instructions outlined below:

1. Sign in to the [AWS Management Console](https://console.aws.amazon.com/)
2. Navigate to the [IAM User creation page](https://console.aws.amazon.com/iamv2/home#/users/create)
3. Specify a user name and select **Next**. You can name the user anything but we will call it "amplify-dev"

  ![AWS IAM user creation dialog with "amplify-dev" input as the user name](/images/gen2/account-setup/user1.png)

4. Select **Attach policies directly** and select **AmplifyBackendDeployFullAccess** as the Permissions policy

  ![AWS IAM "set permissions" view with the "AmplifyBackendDeployFullAccess" managed policy selected](/images/gen2/account-setup/user2.png)

5. Select **Next**
6. On the Review page, check that everything looks good and select **Create user**

  ![AWS IAM "review and create" view with relevant information from previous steps](/images/gen2/account-setup/user3.png)

7. This will redirect to the _Users_ list page. Select the user you just created

  ![AWS IAM users page with "amplify-dev" selected](/images/gen2/account-setup/user4.png)

8. On the user details page, navigate to the **Security credentials** tab, scroll down to **Access keys** and select **Create access keys**

  ![AWS IAM user security credentials tab](/images/gen2/account-setup/user5.png)

9. On the next page, select **Command Line Interface**, acknowledge the warning, and select **Next**.

  ![AWS IAM access key best practices & alternatives page with "command line interface" selected](/images/gen2/account-setup/user6.png)

10. On the next page select **Create access key**. You will then see a page with the access keys for the user. Use the copy icon to copy these values to your clipboard, then return to the CLI

  ![AWS IAM "retrieve access keys" page showing to use the "copy" icon for the Access key and Security access key](/images/gen2/account-setup/user7.png)

11. Next, enter the credentials of the newly created IAM user, including the access key, secret access key, and lastly select the AWS region to use with the profile.

  {/* @TODO replace this image with one that calls the profile `amplify-dev` */}
  ![Terminal running "npx amplify configure profile"](/images/gen2/account-setup/profile1.png)

## Configure an IAM role

## Configure IAM Identity Center

{/* https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html */}
{/* https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html */}
{/* https://docs.aws.amazon.com/singlesignon/latest/userguide/getting-started.html */}

## Bootstrapping AWS account

Before you can start creating the cloud sandbox environment, Amplify will need to complete a one-time bootstrap setup for the account and region before it can start deploying resources.

<Accordion title="What is bootstrapping?" eyebrow="Learn more">

Bootstrapping is the process of provisioning resources for the AWS CDK before you can deploy AWS CDK apps into an AWS environment. These resources include an Amazon S3 bucket for storing files and IAM roles that grant permissions needed to perform deployments. The required resources are defined in an AWS CloudFormation stack, called the bootstrap stack, which is usually named `CDKToolkit`. Like any AWS CloudFormation stack, it appears in the AWS CloudFormation console once it is deployed. You can learn more about this process in the [CDK documentation](https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping.html).

</Accordion>

You can set up a distinct profiles for each developer on your team and they can now start developing their fullstack applications locally by creating an isolated sandbox environment as follows:

```bash
npx amplify sandbox --profile <value>
```

![](/images/gen2/account-setup/profile4.png)

During the first time setup, `amplify sandbox` will ask you to sign into the AWS Console. Once you're signed in, you will be redirected to the Amplify Console. Select **Initialize setup now**.

![](/images/gen2/account-setup/profile5.png)

It may take a few minutes for the bootstrapping process to complete.

![](/images/gen2/account-setup/profile6.png)

![](/images/gen2/account-setup/profile7.png)

Done! You have successfully completed the bootstrapping process and you can now return to the terminal to create a new Amplify Sandbox environment:

```bash
npx amplify sandbox --profile <value>
```
