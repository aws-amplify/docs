export const meta = {
  title: 'Getting started',
  description:
    'Learn how to get started with AWS Amplify (Gen 2).'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };

}

AWS Amplify is a collection of cloud services and libraries for fullstack application development. Amplify provides frontend libraries, UI components, backend building, and frontend hosting for building fullstack cloud apps. This tutorial will teach you how to use Amplify's new code-first developer experience to build a fullstack application with data, authentication, and frontend hosting which are all deployed to AWS. If you're completely new to AWS Amplify, you may want to read more about [how it works](https://docs.amplify.aws/how-amplify-works/) and [the concepts behind the second generation of AWS Amplify](/concepts), which this tutorial will use.

This getting started guide will walk you through how to build a to do list application with TypeScript, Next.js, and React. If you're new to these technologies, we recommend you go through the official [React](https://react.dev/learn/tutorial-tic-tac-toe), [Next.js](https://nextjs.org/docs/getting-started/installation), and [TypeScript](https://www.typescriptlang.org/docs/handbook/typescript-from-scratch.html) tutorials first.

In this tutorial you will learn:
- How to initialize a new Amplify Code-first DX application 
- 
- 

## Prerequisites

Before you get started, make sure you have the following installed:

- [Node.js](https://nodejs.org/) v14.x or later
- [npm v6.14.4](https://www.npmjs.com/) or later
- [git](https://git-scm.com/) v2.14.1 or later

You will also need to [create an AWS Account](https://portal.aws.amazon.com/billing/signup). Note that AWS Amplify is part of the [AWS Free Tier](https://aws.amazon.com/amplify/pricing/).

## Create a Project

First, you'll need to create a new Next.js app. We will use TypeScript for this project, we won't use Tailwind CSS, and we will use Next.js's App Router. The following command will create a Next.js app in a directory called `amplify-gen2-getting-started`. You will be prompted with three questions about your preferences for your app which you can 

  npm={`npx create-next-app amplify-gen2-getting-started --app --typescript --no-tailwind --src-dir --eslint --no-import-alias\ncd amplify-gen2-getting-started`}
  yarn={`yarn create next-app amplify-gen2-getting-started --app --typescript --no-tailwind --src-dir --eslint --no-import-alias\ncd my-app`}
  pnpm={`pnpm create next-app amplify-gen2-getting-started --app --typescript --no-tailwind --src-dir --eslint --no-import-alias\ncd amplify-gen2-getting-started`}

Amplify has a [CLI tool](https://www.npmjs.com/package/create-amplify) called `create-amplify` which will initialize Amplify in your project. You can use this command in an existing frontend application with little to no disturbances.

  npm="npm create amplify"
  yarn="yarn create amplify"
  pnpm="pnpm create amplify"

You will be asked `? Where should we create your project?`. Press your enter key to choose your current directory.

Running this command will scaffold a lightweight Amplify project in your current project with the following files:

```text
â”œâ”€â”€ amplify/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”œâ”€â”€ backend.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ node_modules/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

## Create a Cloud Sandbox

Now that Amplify's initialized, you're ready to create your first cloud sandbox which will allow you to test your changes rapidly with deployed AWS resources. When you're working with a team, each developer will have their own personal cloud sandbox.

> Sandbox should not be used for production applications.

To use Amplify's [Sandbox mode](http://localhost:3000#fix-me), run the following command:

  npm="npx amplify sandbox"
  yarn="yarn amplify sandbox"
  pnpm="pnpm amplify sandbox"

When you're done with your development session, you can shut down your sandbox and it will prompt you to tear down the resources you were using.

## Data

If you open up the `/amplify/data/resource.ts` file in your text editor, you'll see some generated code:

```ts
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    name: a.string(),
    order: a.string(),
  }),
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({ schema });
```
The schema generated by Amplify is for a Todo app. First, we'll define a schema, which is a blueprint for how our app's data will be laid out. Within the schema, we'll define models which will correspond to database table - `Todo` in the above code. Finally, we'll define fields which are attributes which each data instance will have - in the generated code the fields are `name` and `description`. Each field will have a type attached to it, in the above examples we are stating that both `name` and `description` are strings.

Let's make a quick change to our data model and add a `done` field which will be a `boolean` which can be set to `true` or `false` depending if our Todo list item is complete.

```diff
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
+   done: a.boolean()
  }),
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema,
});
```

Once you save your change to the data model, your changes will be deployed in seconds within your cloud sandbox. 

## Authentication

Each of the `resource.ts` files is where you _define_ the corresponding backend resource:

```ts title="amplify/auth/resource.ts"
import { defineAuth } from '@aws-amplify/backend';

export const auth = defineAuth({
  loginWith: {
    email: true,
  },
});
```

The definitions are then imported and set in the `backend`:

```ts title="amplify/backend.ts"
import { defineBackend } from '@aws-amplify/backend';
import { auth } from './auth/resource.js';
import { data } from './data/resource.js';

defineBackend({
  auth,
  data,
});
```

### Add auth to your frontend

First, install the Amplify UI component library:


  npm="npm add @aws-amplify/ui-react"
  yarn="yarn add @aws-amplify/ui-react"
  pnpm="pnpm add @aws-amplify/ui-react"


Next, in your app's entry point (e.g. `pages/_app.ts`, etc.), add the following imports and wrap your App in the `withAuthenticator` function:

```ts title="pages/_app.ts"
import { withAuthenticator } from '@aws-amplify/ui-react';
import { Amplify } from 'aws-amplify';
import config from '@/amplifyconfiguration.json';
import '@aws-amplify/ui-react/styles.css';
import '@/styles/globals.css';
import type { AppProps } from 'next/app';

// configure the Amplify client library with the configuration generated by `amplify sandbox`
Amplify.configure(config);

function App({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />;
}

export default withAuthenticator(App);
```

Run your application with `npm run dev` and navigate to `http://localhost:3000`. You should now see the authenticator, which is already configured and ready for your first sign-up!

## Data

### Configure data resource

```ts title="amplify/data/resource.ts"
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
    comment: a.string(),
    priority: a.enum(['low', 'medium', 'high']).default('low'),
  }),
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema,
});
```

### Add data to your frontend

Modify your app's home page file (e.g. `pages/index.tsx`) with the following contents:

```ts title="pages/index.tsx"
import { useState, useEffect } from 'react';
import { generateClient } from 'aws-amplify/data';
import { Schema } from '@/amplify/data/resource';

// generate your data client using the Schema from your backend
const client = generateClient<Schema>();

export default function HomePage() {
  const [todos, setTodos] = useState<Schema['Todo'][]>([]);

  async function listTodos() {
    const { data } = await client.models.Todo.list();
    setTodos(data);
  }

  useEffect(() => {
    listTodos();
  }, []);

  return (
    <main>
      <h1>Hello, Amplify ðŸ‘‹</h1>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id}>{todo.name}</li>
        ))}
      </ul>
    </main>
  );
}
```

Once you save the file and navigate back to `http://localhost:3000` you should see an empty list of todos.

## Iterating on your backend

With Amplify running in [Sandbox mode](http://localhost:3000), try making a change to your data model and hit save. Changes are deployed in seconds.

```ts {6} showLineNumbers
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
    comment: a.string(),
    priority: a.enum(['low', 'medium', 'high']).default('low'),
  }),
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema,
});
```

## Deploy and host

In order to share your app with others, Amplify will need to connect to a git repo as the source of truth for your project.

### Create a remote git repository

If you already have your project remotely hosted in a git repository, you can skip this step. Otherwise, navigate to your preferred git provider, and add your project to a new repo.

Amplify supports the following git providers:

- Github: `gh repo create`
- CodeCatalyst: `something`
- CodeCommit: `something`
- Gitlab: `something`
- Bitbucket: `something`

### Connect repo to Amplify Console

[TODO fix]: # ( ![Amplify Console view for choosing a git provider] (/images/gen2/console1.jpg))

### Manage your app

[TODO fix]: # ( ![Amplify Console view for git-based deployments showcasing build status and backend resources] (/images/gen2/console2.png)])

[TODO fix]: # (![Amplify Console view for backend data resource's content management system] (/images/gen2/console3.png)])
