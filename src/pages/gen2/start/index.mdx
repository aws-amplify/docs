export const meta = {
  title: 'Getting started',
  description: 'Learn how to get started with AWS Amplify (Gen 2).'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };
}

## Installation

Open your existing project or create a new one:

```bash
npm create next-app -- my-app --typescript
cd my-app
```

The easiest way to get started with AWS Amplify is through [npm](https://npmjs.com) with [`create-amplify`](https://www.npmjs.com/package/create-amplify)

```bash
npm create amplify
```

You can run this command from within your existing project with little to no disturbances. It will scaffold a lightweight Amplify project with the following files:

```text
â”œâ”€â”€ amplify/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”œâ”€â”€ backend.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ node_modules/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

Once scaffolded, you're ready to create your first cloud sandbox. Amplify gives every developer a personal cloud sandbox where they can test changes rapidly using live AWS services. Sandbox should not be used for production applications. To use Amplify's [Sandbox mode](http://localhost:3000#fix-me), run the following command:

```bash
npx amplify sandbox
```

Try making a change to your data model and hit save. Changes are deployed in seconds.

```ts {6} showLineNumbers
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
    priority: a.enum(['low', 'medium', 'high']).default('low')
  })
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema
});
```

## Authentication

Each of the `resource.ts` files is where you _define_ the corresponding backend resource:

```ts title="amplify/auth/resource.ts"
import { defineAuth } from '@aws-amplify/backend';

export const auth = defineAuth({
  loginWith: {
    email: true
  }
});
```

The definitions are then imported and set in the `backend`:

```ts title="amplify/backend.ts"
import { defineBackend } from '@aws-amplify/backend';
import { auth } from './auth/resource.js';
import { data } from './data/resource.js';

defineBackend({
  auth,
  data
});
```

### Add auth to your frontend

First, install the Amplify UI component library:

```bash
npm add @aws-amplify/ui-react
```

Next, in your app's entry point (e.g. `pages/_app.ts`, etc.), add the following imports and wrap your App in the `withAuthenticator` function:

```ts title="pages/_app.ts"
import { withAuthenticator } from '@aws-amplify/ui-react';
import { Amplify } from 'aws-amplify';
import config from '@/amplifyconfiguration.json';
import '@aws-amplify/ui-react/styles.css';
import '@/styles/globals.css';
import type { AppProps } from 'next/app';

// configure the Amplify client library with the configuration generated by `amplify sandbox`
Amplify.configure(config);

function App({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />;
}

export default withAuthenticator(App);
```

Run your application with `npm run dev` and navigate to `http://localhost:3000`. You should now see the authenticator, which is already configured and ready for your first sign-up!

## Data

### Configure data resource

```ts title="amplify/data/resource.ts"
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
    comment: a.string(),
    priority: a.enum(['low', 'medium', 'high']).default('low')
  })
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema
});
```

### Add data to your frontend

Modify your app's home page file (e.g. `pages/index.tsx`) with the following contents:

```ts title="pages/index.tsx"
import { useState, useEffect } from 'react';
import { generateClient } from 'aws-amplify/data';
import { Schema } from '@/amplify/data/resource';

// generate your data client using the Schema from your backend
const client = generateClient<Schema>();

export default function HomePage() {
  const [todos, setTodos] = useState<Schema['Todo'][]>([]);

  async function listTodos() {
    const { data } = await client.models.Todo.list();
    setTodos(data);
  }

  useEffect(() => {
    listTodos();
  }, []);

  return (
    <main>
      <h1>Hello, Amplify ðŸ‘‹</h1>
      <ul>
        {todos.map((todo) => (
          <li key={todo.id}>{todo.name}</li>
        ))}
      </ul>
    </main>
  );
}
```

Once you save the file and navigate back to `http://localhost:3000` you should see an empty list of todos.

## Iterating on your backend

With Amplify running in [Sandbox mode](http://localhost:3000), try making a change to your data model and hit save. Changes are deployed in seconds.

```ts {6} showLineNumbers
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  Todo: a.model({
    title: a.string(),
    description: a.string(),
    comment: a.string(),
    priority: a.enum(['low', 'medium', 'high']).default('low')
  })
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema
});
```

## Deploy and host

In order to share your app with others, Amplify will need to connect to a git repo as the source of truth for your project.

### Create a remote git repository

If you already have your project remotely hosted in a git repository, you can skip this step. Otherwise, navigate to your preferred git provider, and add your project to a new repo.

Amplify supports the following git providers:

- Github: `gh repo create`
- CodeCatalyst: `something`
- CodeCommit: `something`
- Gitlab: `something`
- Bitbucket: `something`

### Connect repo to Amplify Console

[TODO fix]: # ( ![Amplify Console view for choosing a git provider] (/images/gen2/console1.jpg))

### Manage your app

[TODO fix]: # ( ![Amplify Console view for git-based deployments showcasing build status and backend resources] (/images/gen2/console2.png)])

[TODO fix]: # (![Amplify Console view for backend data resource's content management system] (/images/gen2/console3.png)])
