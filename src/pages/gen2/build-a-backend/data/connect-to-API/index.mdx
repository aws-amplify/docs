export const meta = {
  title: 'Connect your app code to API',
  description:
    'Learn how to connect your app code to an API.'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };

}

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Connect app code to API

You can use the Amplify library to connect GraphQL APIs created in various ways:
- Amplify vNext-generated API (backend/data.ts)
- Amplify Classic-generated API (backend/api/<api-name\>/schema.graphql)
- any existing AWS AppSync GraphQL API
- GraphQL APIs hosted using API Gateway

Depending on the API you connect to and the way the API is provisioned, you'll get different levels of support for end-to-end typing. 

To connect your app code to your GraphQL API, you need to provide the API endpoint URL and the default authorization mode. 

:::note
The **Default Authorization Mode** is the authorization mode that the GraphQL API should be authorized with when no other authorization mode is specified at the request time. **Default Authorization Mode** is a setting that you can configure for the AWS Amplify-generated APIs and AWS AppSync GraphQL APIs.
:::

## Configure the GraphQL API endpoint URL

The Amplify library connects you to a GraphQL API endpoint based on the information provided to `Amplify.configure()`.

<Tabs>

  <TabItem value="vNext" label="Samsara" default>

When running the cloud sandbox (`amplify sandbox`), an `amplifyconfiguration.js` file is generated for you. This file contains your API's endpoint information, auth configurations, and typings details.

```ts
import { Amplify } from 'aws-amplify'
// highlight-next-line
import amplifyconfiguration from './amplifyconfiguration'

// highlight-next-line
Amplify.configure(amplifyconfiguration)
```

  </TabItem>
  <TabItem value="classic" label="Amplify CLI">

When you deploy your backend (`amplify push`), an `aws-exports.js` file is generated for you. This file contains your API's endpoint information and auth configurations.

```ts
import { Amplify } from 'aws-amplify'
// highlight-next-line
import awsconfig from './aws-exports'

// highlight-next-line
Amplify.configure(awsconfig)
```

  </TabItem>
  <TabItem value="appsync" label="Existing AppSync GraphQL API">

When working with existing GraphQL APIs, you must manually provide your API endpoint and auth configurations. First, to configure the GraphQL API endpoint URL, set the `aws_appsync_graphqlEndpoint` and `aws_appsync_region` values. 

```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  // highlight-start
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',
  // highlight-end
})
```

  </TabItem>
</Tabs>

## Configure the default authorization mode settings

Amplify library supports the following authorization modes for GraphQL APIs:
- API Key
- Cognito user pool
- AWS IAM
- OpenID Connect
- Lambda authorizer
- Custom request headers

If you use Samsara or Amplify CLI to generate your Amplify client configurations (`amplifyconfiguration.ts`/`aws-exports.js`), then this setting is automatically configured for you as part of [Configure the GraphQL API endpoint URL](#configure-the-graphql-api-endpoint-url).

Use the following guides to customize the authorization modes for your existing GraphQL APIs.  

### Use API Key as the default authorization mode

```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',

  // Set the auth type as "API_KEY" and pass in the API key value
  // highlight-start
  aws_appsync_authenticationType: 'API_KEY',
  aws_appsync_apiKey: 'da2-xxxxxxxxxxxxxxxxxxxxxxxxxx'
  // highlight-end
})
```

### Use Amazon Cognito user pool as the default authorization mode

[TK add context on auth]

```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',

  // Set the auth type as "AMAZON_COGNITO_USER_POOLS"
  // highlight-start
  aws_appsync_authenticationType: 'AMAZON_COGNITO_USER_POOLS',
  // highlight-end
})
```

### Use AWS IAM as the default authorization mode

[TK add context on auth]

```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',

  // Set the auth type as "AWS_IAM"
  // highlight-start
  aws_appsync_authenticationType: 'AWS_IAM',
  // highlight-end
})
```

### Use OpenID Connect as the default authorization mode

[TK add context on]  // Before calling API.graphql(...) is required to do Auth.federatedSignIn(...) check authentication guide for details.


```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',

  // Set the auth type as "OPENID_CONNECT"
  // highlight-start
  aws_appsync_authenticationType: 'OPENID_CONNECT',
  // highlight-end
})
```

### Use Lambda authorizer as the default authorization mode

You can implement your own custom API authorization logic using an AWS Lambda function. To add a Lambda as an authorization mode for your AppSync API, go to the Settings section of the AppSync console.

If you are using a Lambda function as an authorization mode with your AppSync API, you will need to pass an authentication token with each API request and will need to manage token refresh in your application.

```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',

  // Set the auth type as "AWS_LAMBDA"
  // highlight-start
  aws_appsync_authenticationType: 'AWS_LAMBDA',
  // highlight-end
})
```

Next, when you make the GraphQL API request, you can provide an `authToken` parameter to add to your request header.

```ts
const getAuthToken = () => 'myAuthToken';
const lambdaAuthToken = getAuthToken();

const createdTodo = await client.graphql({
  query: queries.listTodos,
  // highlight-next-line
  authToken: lambdaAuthToken
});
```

### Use custom request headers for API authorization

When working with a non-AppSync GraphQL endpoint, you may need to set request headers for authorization purposes. This is done by passing a `graphql_headers` function into the configuration:

```ts
import { Amplify } from 'aws-amplify'

Amplify.configure({
  aws_appsync_graphqlEndpoint: 'https://abcxyz.appsync-api.us-east-1.amazonaws.com/graphql',
  aws_appsync_region: 'us-east-1',

  // Set the graphql_headers value and pass in a function to supply headers
  // highlight-start
  API: {
    graphql_headers: async() => ({
      'My-Custom-Header': 'My Value'
    })
  }
  // highlight-end
})
```

## Generate a type-safe API client
