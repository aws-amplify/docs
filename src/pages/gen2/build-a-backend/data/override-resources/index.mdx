export const meta = {
  title: 'Modify Amplify-generated AWS resources',
  description:
    'Modify and customize existing AWS resources generated by the Amplify GraphQL API.'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };

}

Amplify GraphQL API uses a variety of auto-generated, underlying AWS services and resources. You can customize these underlying resources to optimize the deployed stack for your specific use case.

In your Amplify app, you can access every underlying resource using CDK ["L2"](https://docs.aws.amazon.com/cdk/v2/guide/constructs.html#constructs_using) or ["L1"](https://docs.aws.amazon.com/cdk/v2/guide/constructs.html#constructs_l1_using) constructs. Access the generated resources as L2 constructs via the `.resources` property on the returned stack or access the generated resources as L1 constructs using the `.resources.cfnResources` property.

```ts
import { defineBackend } from '@aws-amplify/backend';
import { data } from './data/resource.js';

const backend = defineBackend({
  data
});

const dataResources = backend.data.resources;

dataResources.cfnResources.cfnGraphqlApi.name;

Object.values(dataResources.amplifyDynamoDbTables).forEach((table) => {
  table.pointInTimeRecoveryEnabled = true;
});
```

## Customize Amplify-generated AppSync GraphQL API resources

Apply all the customizations on `backend.data.resources.graphqlApi` or `backend.data.resources.cfnResources.cfnGraphqlApi`. For example, to enable X-Ray tracing for the AppSync GraphQL API:

```ts
import { defineBackend } from '@aws-amplify/backend';
import { data } from './data/resource.js';

const backend = defineBackend({
  data
});

backend.data.resources.cfnResources.cfnGraphqlApi.xrayEnabled = true;
```

## Customize Amplify-generated resources for data models

Pass in the model type name into `backend.data.resources.amplifyDynamoDbTables["MODEL_NAME"]` to modify the resources generated for that particular model type. For example, to enable time-to-live on the Todo `@model` type's DynamoDB table:

```ts
import { defineBackend } from '@aws-amplify/backend';
import { data } from './data/resource.js';

const backend = defineBackend({
  data
});

backend.data.resources.amplifyDynamoDbTables["Todo"].timeToLiveAttribute = {
  attributeName: "ttl",
  enabled: true,
};
```

### Example - Configure billing mode on a DynamoDB table

Set the [DynamoDB billing mode](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html#cfn-dynamodb-table-billingmode) for the DynamoDB table as either "PROVISIONED" or "PAY_PER_REQUEST".

```ts
import { defineBackend } from '@aws-amplify/backend';
import { data } from './data/resource.js';
import { BillingMode } from "aws-cdk-lib/aws-dynamodb";

const backend = defineBackend({
  data
});

backend.data.resources.amplifyDynamoDbTables['Todo'].billingMode = BillingMode.PAY_PER_REQUEST;
```

### Example - Configure provisioned throughput for a DynamoDB table

Override the default [ProvisionedThroughput](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html#cfn-dynamodb-table-provisionedthroughput) provisioned for each model table and its Global Secondary Indexes (GSI). This override is only valid if the "DynamoDBBillingMode" is set to "PROVISIONED".

```ts
import { defineBackend } from '@aws-amplify/backend';
import { data } from './data/resource.js';

const backend = defineBackend({
  data
});

backend.data.resources.amplifyDynamoDbTables["Todo"].provisionedThroughput = {
  readCapacityUnits: 5,
  writeCapacityUnits: 5,
};
```

### Example - Enable point-in-time recovery for a DynamoDB table

Enable/disable [DynamoDB point-in-time recovery](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-dynamodb-table-pointintimerecoveryspecification.html) for each model table.

```ts
import { defineBackend } from '@aws-amplify/backend';
import { data } from './data/resource.js';

const backend = defineBackend({
  data
});

backend.data.resources.amplifyDynamoDbTables['Todo'].pointInTimeRecoveryEnabled: true;
```
