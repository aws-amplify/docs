export const meta = {
  title: 'Modify Amplify-generated AWS resources',
  description:
    'Learn how to modify existing AWS resources.'
};

export function getStaticProps(context) {
  return {
    props: {
      meta
    }
  };

}

Amplify GraphQL API uses a variety of auto-generated, underlying AWS services and resources. You can customize these underlying resources to optimize the deployed stack for your specific use case.


In your Amplify app, you can access every underlying resource using CDK ["L2"](https://docs.aws.amazon.com/cdk/v2/guide/constructs.html#constructs_using) or ["L1" construct](https://docs.aws.amazon.com/cdk/v2/guide/constructs.html#constructs_l1_using). Access the generated resources as L2 constructs via the `.resources` property on the returned stack or access the generated resources as L1 constructs using the `.resources.cfnResources` property.

```ts
import { defineBackend } from "@aws-amplify/backend";
import { data } from "./data/resource.js";

const backend = defineBackend({
  data,
});

const dataResources = backend.resources.data.resources;

// Access L2 resources under `.resources`
dataResources.tables["Todo"].tableArn;

// Access L1 resources under `.resources.cfnResources`
Object.values(dataResources.cfnResources.cfnTables).forEach((table) => {
  table.pointInTimeRecoverySpecification = {
    pointInTimeRecoveryEnabled: false,
  };
});
```

## Customize Amplify-generated AppSync GraphQL API resources


Apply all the customizations on `backend.resources.data.resources.graphqlApi` or `backend.resources.data.resources.cfnResources.cfnGraphqlApi`. For example to enable X-Ray tracing for the AppSync GraphQL API:

```ts
import { defineBackend } from "@aws-amplify/backend";
import { data } from "./data/resource.js";

const backend = defineBackend({
  data,
});

backend.resources.data.resources.cfnResources.cfnGraphqlApi.xrayEnabled = true;
```

## Customize Amplify-generated resources for data models


Apply all the customizations on `backend.resources.data.resources.tables["MODEL_NAME"]` or `backend.resources.data.resources.cfnResources.cfnTables["MODEL_NAME"]`. Pass in the model type name into `backend.resources.data.resources.cfnResources.cfnTables["MODEL_NAME"]` to modify the resources generated for that particular model type. For example, to enable time-to-live on the Todo `@model` type's DynamoDB table:

```ts
import { defineBackend } from "@aws-amplify/backend";
import { data } from "./data/resource.js";

const backend = defineBackend({
  data,
});

backend.resources.data.resources.cfnResources.cfnTables['Todo'].timeToLiveSpecification = {
  attributeName: 'ttl',
  enabled: true
};
```

### Example - Configure DynamoDB table's billing mode

Set the [DynamoDB billing mode](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html#cfn-dynamodb-table-billingmode) for the DynamoDB table. Either "PROVISIONED" or "PAY_PER_REQUEST".


```ts
import { defineBackend } from "@aws-amplify/backend";
import { data } from "./data/resource.js";

const backend = defineBackend({
  data,
});

backend.resources.data.resources.cfnResources.cfnTables['Todo'].billingMode = 'PAY_PER_REQUEST';
```

### Example - Configure provisioned throughput for DynamoDB table

Override the default [ProvisionedThroughput](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html#cfn-dynamodb-table-provisionedthroughput) provisioned for each model table and its Global Secondary Indexes (GSI).

Only valid if the "DynamoDBBillingMode" is set to "PROVISIONED"

```ts
import { defineBackend } from "@aws-amplify/backend";
import { data } from "./data/resource.js";

const backend = defineBackend({
  data,
});

backend.resources.data.resources.cfnResources.cfnTables["Todo"].provisionedThroughput = {
  readCapacityUnits: 5,
  writeCapacityUnits: 5,
};
```

### Example - Enable point-in-time recovery for DynamoDB table

Enable/disable [DynamoDB point-in-time recovery](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-dynamodb-table-pointintimerecoveryspecification.html) for each model table.


```ts
import { defineBackend } from "@aws-amplify/backend";
import { data } from "./data/resource.js";

const backend = defineBackend({
  data,
});

backend.resources.data.resources.cfnResources.cfnTables["Todo"].pointInTimeRecoverySpecification = {
  pointInTimeRecoveryEnabled: true,
};
```
