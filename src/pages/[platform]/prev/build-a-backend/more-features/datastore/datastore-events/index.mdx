import { getCustomStaticPath } from '@/utils/getCustomStaticPath';

export const meta = {
  title: 'DataStore events',
  description: 'Listening to DataStore events',
  platforms: [
    'flutter',
    'swift',
    'android',
    'javascript',
    'react-native',
    'angular',
    'nextjs',
    'react',
    'vue'
  ],
  canonicalObjects: [
    {
      platforms: [
        'react',
        'nextjs',
        'vue',
        'javascript',
        'angular'
      ],
      canonicalPath: '/javascript/prev/build-a-backend/more-features/datastore/datastore-events/'
    }
  ]
};

export const getStaticPaths = async () => {
  return getCustomStaticPath(meta.platforms);
};

export function getStaticProps(context) {
  return {
    props: {
      platform: context.params.platform,
      meta
    }
  };
}

import ios_maintenance from '/src/fragments/lib-v1/ios-maintenance.mdx';

<Fragments fragments={{ swift: ios_maintenance }} />

import flutter_maintenance from '/src/fragments/lib-v1/flutter-maintenance.mdx';

<Fragments fragments={{ flutter: flutter_maintenance }} />

import android_maintenance from '/src/fragments/lib-v1/android-maintenance.mdx';

<Fragments fragments={{ android: android_maintenance }} />

DataStore periodically publishes state notifications onto Amplify's Hub. You can subscribe to the Hub to gain insight into the internal state of the DataStore. Events are published when:

- Your device loses or regains network connectivity;
- Data is synchronized with the Cloud;
- There are new, pending changes that have not yet been synchronized.

The following DataStore events are defined:

## networkStatus

Dispatched when DataStore starts and every time network status changes

HubPayload `NetworkStatusEvent` contains:

- `active` (Bool): true if the DataStore is on a network that can connect the Cloud; false, otherwise

## subscriptionsEstablished

Dispatched when DataStore has finished establishing its subscriptions to all models

HubPayload: N/A

## syncQueriesStarted

Dispatched when DataStore is about to perform its initial sync queries

HubPayload `syncQueriesStartedEvent` contains:

- `models` ([String]): an array of each model's `name`

import js0 from '/src/fragments/lib-v1/datastore/js/datastore-events/model-synced.mdx';

<Fragments
  fragments={{
    javascript: js0,
    angular: js0,
    nextjs: js0,
    react: js0,
    vue: js0
  }}
/>

import reactnative0 from '/src/fragments/lib-v1/datastore/js/datastore-events/model-synced.mdx';

<Fragments fragments={{ 'react-native': reactnative0 }} />

import android1 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/model-synced.mdx';

<Fragments fragments={{ android: android1 }} />

import ios3 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/model-synced.mdx';

<Fragments fragments={{ swift: ios3 }} />

import flutter2 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/model-synced.mdx';

<Fragments fragments={{ flutter: flutter2 }} />

## syncQueriesReady

Dispatched when all models have been synced from the cloud

HubPayload: N/A

## ready

Dispatched when DataStore as a whole is ready, at this point all data is available

HubPayload: N/A

import js4 from '/src/fragments/lib-v1/datastore/js/datastore-events/outbox-mutation-enqueued.mdx';

<Fragments
  fragments={{
    javascript: js4,
    angular: js4,
    nextjs: js4,
    react: js4,
    vue: js4
  }}
/>

import reactnative1 from '/src/fragments/lib-v1/datastore/js/datastore-events/outbox-mutation-enqueued.mdx';

<Fragments fragments={{ 'react-native': reactnative1 }} />

import android5 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/outbox-mutation-enqueued.mdx';

<Fragments fragments={{ android: android5 }} />

import flutter6 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/outbox-mutation-enqueued.mdx';

<Fragments fragments={{ flutter: flutter6 }} />

import ios7 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/outbox-mutation-enqueued.mdx';

<Fragments fragments={{ swift: ios7 }} />

import android9 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/outbox-mutation-processed.mdx';

<Fragments fragments={{ android: android9 }} />

import flutter10 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/outbox-mutation-processed.mdx';

<Fragments fragments={{ flutter: flutter10 }} />

import ios11 from '/src/fragments/lib-v1/datastore/native_common/datastore-events/outbox-mutation-processed.mdx';

<Fragments fragments={{ swift: ios11 }} />

import android12 from '/src/fragments/lib-v1/datastore/android/datastore-events/outbox-mutation-failed.mdx';

<Fragments fragments={{ android: android12 }} />

## outboxStatus

Dispatched when:

- the DataStore starts
- each time a local mutation is enqueued into the outbox
- each time a local mutation is finished processing

HubPayload `OutboxStatusEvent` contains:

- `isEmpty` (Bool): a boolean value indicating that there are no local changes still pending upload to the Cloud

## Usage

To see if the network status is active, you could set up the following listener:

import js13 from '/src/fragments/lib-v1/datastore/js/datastore-events.mdx';

<Fragments
  fragments={{
    javascript: js13,
    angular: js13,
    nextjs: js13,
    react: js13,
    vue: js13
  }}
/>

import reactnative3 from '/src/fragments/lib-v1/datastore/js/datastore-events.mdx';

<Fragments fragments={{ 'react-native': reactnative3 }} />

import android14 from '/src/fragments/lib-v1/datastore/android/datastore-events.mdx';

<Fragments fragments={{ android: android14 }} />

import ios15 from '/src/fragments/lib-v1/datastore/ios/datastore-events.mdx';

<Fragments fragments={{ swift: ios15 }} />

import flutter16 from '/src/fragments/lib-v1/datastore/flutter/datastore-events.mdx';

<Fragments fragments={{ flutter: flutter16 }} />
