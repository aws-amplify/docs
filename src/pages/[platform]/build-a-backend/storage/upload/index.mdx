import { getCustomStaticPath } from '@/utils/getCustomStaticPath';

export const meta = {
  title: 'Upload files',
  description:
    "Learn more about how to upload files using Amplify's storage category",
  platforms: ['javascript', 'flutter', 'swift', 'android', 'react-native', 'angular', 'nextjs', 'react', 'vue'] 
};

export const getStaticPaths = async () => {
  return getCustomStaticPath(meta.platforms);
};

export function getStaticProps(context) {
  return {
    props: {
      platform: context.params.platform,
      meta
    }
  };
}

import android_upload from '/src/fragments/lib/storage/android/upload.mdx';
import flutter_upload from '/src/fragments/lib/storage/flutter/upload.mdx';
import ios_upload from '/src/fragments/lib/storage/ios/upload.mdx';

<Fragments
  fragments={{
    android: android_upload,
    flutter: flutter_upload,
    swift: ios_upload
  }}
/>

<InlineFilter filters={['javascript', 'react-native', 'angular', 'nextjs', 'react', 'vue']}>

## uploadData

The `uploadData` method uploads files into Amazon S3.

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { UploadDataOutput, uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function uploadFile({ key, data, options }: FileUploadParams) {
  try {
    const uploadDataOutput: UploadDataOutput = uploadData({
      key,
      data,
      options,
    });
    const result = await uploadDataOutput.result;
    console.log('Succeeded: ', result);
  } catch (error) {
    console.log('Error: ', error);
    throw error;
  }
}

async function uploadImage(): Promise<void> {
  await uploadFile({
    key: 'filename',
    data: 'data',
    options: {
      accessLevel: 'guest', // defaults to `guest` but can be 'private' | 'protected' | 'guest'
    },
  });
}
```
</Block>
<Block name="JavaScript">
```javascript
import { uploadData } from 'aws-amplify/storage';

try {
  const result = await uploadData({
    key: filename,
    data: file,
    options: {
      accessLevel: 'guest', // defaults to `guest` but can be 'private' | 'protected' | 'guest'
      onProgress // Optional progress callback.
    }
  }).result;
  console.log('Succeeded: ', result);
} catch (error) {
  console.log('Error : ', error);
}
```
</Block>
</BlockSwitcher>

### Public level

The `accessLevel` defaults to `guest`

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { UploadDataOutput, uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function uploadFile({ key, data, options }: FileUploadParams) {
  try {
    const uploadDataOutput: UploadDataOutput = uploadData({
      key,
      data,
      options,
    });
    const result = await uploadDataOutput.result;
    console.log('Succeeded: ', result);
  } catch (error) {
    console.log('Error: ', error);
    throw error;
  }
}
async function uploadPublicImage(): Promise<void> {
  await uploadFile({
    key: 'filename',
    data: 'data',
  });
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData } from 'aws-amplify/storage';

try {
  const result = await uploadData({
    key: filename,
    data: file
  }).result;
  console.log('Succeeded: ', result);
} catch (error) {
  console.log('Error : ', error);
}
```
</Block>
</BlockSwitcher>

### Protected level
<BlockSwitcher>
<Block name="TypeScript">

```ts
import { UploadDataOutput, uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function uploadFile({ key, data, options }: FileUploadParams) {
  try {
    const uploadDataOutput: UploadDataOutput = uploadData({
      key,
      data,
      options,
    });
    const result = await uploadDataOutput.result;
    console.log('Succeeded: ', result);
  } catch (error) {
    console.log('Error: ', error);
    throw error;
  }
}
async function uploadProtectedImage(): Promise<void> {
  await uploadFile({
    key: 'filename',
    data: 'data',
    options: {
      accessLevel: 'protected',
    },
  });
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData } from 'aws-amplify/storage';

try {
  const result = await uploadData({
    key: filename,
    data: file,
    options: {
      accessLevel: 'protected'
    }
  }).result;
  console.log('Succeeded: ', result);
} catch (error) {
  console.log('Error : ', error);
}
```
</Block>
</BlockSwitcher>

### Private level

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { UploadDataOutput, uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function uploadFile({ key, data, options }: FileUploadParams) {
  try {
    const uploadDataOutput: UploadDataOutput = uploadData({
      key,
      data,
      options,
    });
    const result = await uploadDataOutput.result;
    console.log('Succeeded: ', result);
  } catch (error) {
    console.log('Error: ', error);
    throw error;
  }
}
async function uploadPrivateImage(): Promise<void> {
  await uploadFile({
    key: 'filename',
    data: 'data',
    options: {
      accessLevel: 'private',
    },
  });
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData } from 'aws-amplify/storage';

try {
  const result = await uploadData({
    key: filename,
    data: file,
    options: {
      accessLevel: 'private'
    }
  }).result;
  console.log('Succeeded: ', result);
} catch (error) {
  console.log('Error : ', error);
}
```
</Block>
</BlockSwitcher>

### Monitor progress of upload

To track the progress of your upload, you can use the `onProgress` in options:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { UploadDataOutput, uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function uploadFile({ key, data, options }: FileUploadParams) {
  try {
    const uploadDataOutput: UploadDataOutput = uploadData({
      key,
      data,
      options,
    });
    const result = await uploadDataOutput.result;
    console.log('Succeeded: ', result);
  } catch (error) {
    console.log('Error: ', error);
    throw error;
  }
}
async function monitorProgress(): Promise<void> {
  await uploadFile({
    key: 'filename',
    data: 'data',
    options: {
      onProgress: ({ transferredBytes, totalBytes }) => {
        if (totalBytes) {
          console.log(`Upload progress ${Math.round(transferredBytes / totalBytes) * 100} %`);
        }
      },
    },
  });
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData } from 'aws-amplify/storage';

try {
  const result = uploadData({
    key: filename,
    data: file,
    options: {
      onProgress: ({ transferredBytes, totalBytes }) => {
        if (totalBytes) {
          console.log(
            `Upload progress ${
              Math.round(transferredBytes / totalBytes) * 100
            } %`
          );
        }
      }
    }
  }).result;
  console.log('Key from Response: ', result.key);
} catch (error) {
  console.log('Error : ', error);
}
```
</Block>
</BlockSwitcher>

## Pause and resume upload

We have callback functions that support resuming, pausing, and cancelling `uploadData` requests.

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function pauseAndResume({ key, data, options }: FileUploadParams) {
  const uploadTask = uploadData({ key, data, options });
  //..
  uploadTask.pause();
  //..
  uploadTask.resume();
  //..
  await uploadTask.result;
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData } from 'aws-amplify/storage';

// Pause and resume a task
const uploadTask = uploadData({ key, data: file });
//...
uploadTask.pause();
//...
uploadTask.resume();
//...
await uploadTask.result;
```
</Block>
</BlockSwitcher>

## Cancel upload

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { uploadData, isCancelError } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function cancel({ key, data, options }: FileUploadParams) {
  const uploadTask = uploadData({ key, data, options });
  //..
  uploadTask.cancel();
  //..
  try {
    await uploadTask.result;
  } catch (error) {
    if (isCancelError(error)) {
      // Handle error thrown by task cancellation
    }
  }
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData, isCancelError } from 'aws-amplify/storage';

const uploadTask = uploadData({ key, data: file });
//...
uploadTask.cancel();
try {
  await uploadTask.result;
} catch (error) {
  if (isCancelError(error)) {
    // Handle error thrown by task cancellation
  }
}
```
</Block>
</BlockSwitcher>

Other options available are:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { UploadDataOutput, uploadData } from 'aws-amplify/storage';

type FileUploadParams = {
  key: string;
  data: Blob | ArrayBufferView | ArrayBuffer | string;
  options?: {
    accessLevel?: 'guest' | 'protected' | 'private';
    contentType?: string;
    contentEncoding?: string;
    contentDisposition?: string;
    metadata: { [key: string]: string };
    useAccelerateEndpoint: boolean;
    onProgress?: (event: { transferredBytes: number; totalBytes?: number }) => void;
  };
};

export async function uploadFile({ key, data, options }: FileUploadParams) {
  try {
    const uploadDataOutput: UploadDataOutput = uploadData({
      key,
      data,
      options,
    });
    const result = await uploadDataOutput.result;
    console.log('Succeeded: ', result);
  } catch (error) {
    console.log('Error: ', error);
    throw error;
  }
}

async function uploadTextHtml() {
  await uploadFile({
    key: 'key',
    data: 'data',
    options: {
      contentType: 'text/html', // (String) The default content-type header value of the file when downloading it.
      contentEncoding: 'compress', // (String) The default content-encoding header value of the file when downloading it.
      contentDisposition: 'attachment', // (String) Specifies presentational information for the object
      metadata: { key: 'value', anotherKey: 'anotherValue' }, // (map<String>) A map of metadata to store with the object in S3.
      useAccelerateEndpoint: true, // Whether to use accelerate endpoint.
    },
  });
}
```
</Block>
<Block name="JavaScript">

```javascript
import { uploadData } from 'aws-amplify/storage';

uploadData({
  key,
  data: file,
  options: {
    contentType: 'text/html', // (String) The default content-type header value of the file when downloading it.
    contentEncoding: 'compress', // (String) The default content-encoding header value of the file when downloading it.
    contentDisposition: 'attachment', // (String) Specifies presentational information for the object
    metadata: { key: 'value' }, // (map<String>) A map of metadata to store with the object in S3.
    useAccelerateEndpoint: boolean, // Whether to use accelerate endpoint.
  },
});
```
</Block>
</BlockSwitcher>

When a page refresh occurs during the upload, re-initializing the upload with the same file will continue from previous break point.

<Callout>

Uploads that were initiated over one hour ago will be cancelled automatically. There are instances (e.g device went offline, user logs out) where the incomplete file remains in your S3 account. It is recommended to [setup a s3 lifecycle rule](https://aws.amazon.com/blogs/aws-cloud-financial-management/discovering-and-deleting-incomplete-multipart-uploads-to-lower-amazon-s3-costs/) to automatically cleanup incomplete upload requests.

</Callout>

## Browser uploads

Upload a file in the browser:

```javascript
import { uploadData } from 'aws-amplify/storage';

const uploadDataInBrowser = async () => {
  if (event?.target?.files) {
    const file = event.target.files[0];
    uploadData({
      key: filename,
      data: file
    });
  }
};
```

```html
<h2>Upload File</h2>
<input type="file" onChange="{()" ="" /> uploadDataInBrowser(event)} />
```

</InlineFilter>
