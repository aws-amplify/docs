import { getCustomStaticPath } from '@/utils/getCustomStaticPath';

export const meta = {
  title: 'Remember a device',
  description: 'You can use the device related features of Amazon Cognito UserPools by enabling the Devices features. Go to your Cognito UserPool, click on Devices in Left Navigation Menu and chose one of User Opt In or Always.',
  platforms: [
    'javascript',
    'react-native',
    'flutter',
    'swift',
    'android',
    'angular',
    'nextjs',
    'react',
    'vue'
  ]
};

export const getStaticPaths = async () => {
  return getCustomStaticPath(meta.platforms);
};

export function getStaticProps(context) {
  return {
    props: {
      platform: context.params.platform,
      meta
    }
  };
}

<InlineFilter filters={['javascript','react-native','angular','nextjs','react','vue']}>
<Callout>

**Note:** The [device tracking and remembering](https://aws.amazon.com/blogs/mobile/tracking-and-remembering-devices-using-amazon-cognito-your-user-pools/) features are not available if any of the following conditions are met:

- the federated OAuth flow with Cognito User Pools or Hosted UI is used, or
- the User Pool uses `email/phone_number` or `alias` sign-in method, or
- when the `signIn` API uses the `USER_PASSWORD_AUTH` as the `authFlowType`.

</Callout>

Remembering a device is useful in conjunction with Multi-Factor Authentication (MFA). If MFA is enabled for an Amazon Cognito user pool, end users have to type in a security code received via e-mail or SMS each time they want to sign in. This increases security but comes at the expense of the user's experience.

Remembering a device allows the second factor requirement to be automatically met when the user signs in on that device, thereby reducing friction in the user experience.

## Configure Auth Category

To enable remembered device functionality, open the [Amazon Cognito over AWS console](https://console.aws.amazon.com/cognito).

When the console opens, scroll down to the **Device Tracking** section and select the `Edit` button. This will render the following page allowing you to configure your preference for remembering a user's device.

![Edit device tracking options list is shown, with the don't remember highlighted.](/images/auth/webconsole_remember1.png)

**Choose either Always remember or User Opt-in** depending on whether you want to remember a user's device by default or give the user the ability to choose.

If MFA is enabled for the Cognito user pool, you will have the option to suppress the second factor during multi-factor authentication. **Choose Yes** if you want a remembered device to be used as a second factor mechanism or **No** otherwise.

![Options for allow users to bypass MFA for trusted devices.](/images/auth/webconsole_remember2.png)

When you have made your selection(s), click "Save changes". You are now ready to start updating your code to manage your remembered devices.

## APIs

### Remember Device

You can mark your device as remembered:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { rememberDevice } from 'aws-amplify/auth';

export async function handleRememberDevice() {
  try {
    await rememberDevice();
  } catch (error) {
    console.log(error);
  }
}
```
</Block>
<Block name="JavaScript">

```js
import { rememberDevice } from 'aws-amplify/auth';

export async function handleRememberDevice() {
  try {
    await rememberDevice();
  } catch (error) {
    console.log(error);
  }
}
```
</Block>
</BlockSwitcher>

### Forget Device

You can forget your device by using the following API. Note that forgotten devices are neither remembered nor tracked. See below for the difference between remembered, forgotten and tracked.

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { forgetDevice } from 'aws-amplify/auth';

export async function handleForgetDevice() {
  try {
    await forgetDevice();
  } catch (error) {
    console.log(error);
  }
}
```
</Block>
<Block name="JavaScript">

```js
import { forgetDevice } from 'aws-amplify/auth';

export async function handleForgetDevice() {
  try {
    await forgetDevice();
  } catch (error) {
    console.log(error);
  }
}
```
</Block>
</BlockSwitcher>

### Fetch Devices

You can fetch a list of remembered devices by using the following:

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { fetchDevices } from 'aws-amplify/auth';

export async function handleFetchDevices() {
  try {
    const output = await fetchDevices();
    console.log(output);
  } catch (error) {
    console.log(error);
  }
}
```
</Block>
<Block name="JavaScript">

```js
import { fetchDevices } from 'aws-amplify/auth';

async function handleFetchDevices() {
  try {
    const output = await Auth.fetchDevices();
    console.log(output);
  } catch (error) {
    console.log(error);
  }
}
```
</Block>
</BlockSwitcher>

## Terminology

- **Tracked**
  - Every time the user signs in with a new device, the client is given the device key at the end of a successful authentication event. We use this device key to generate a salt and password verifier which is used to call the ConfirmDevice API. At this point, the device is considered to be **tracked**. Once the device is in a tracked state, you can use the Amazon Cognito console to see the time it started to be tracked, last authentication time, and other information about that device.
- **Remembered**
  - Remembered devices are also tracked. During user authentication, the device key and secret pair assigned to a remembered device is used to authenticate the device to verify that it is the same device that the user previously used to sign in.
- **Not Remembered**
  - A not-remembered device is a tracked device where Cognito has been configured to require users to "Opt-in" to remember a device, but the user has not opt-ed in to having the device remembered. This use case is used for users signing into their application from a device that they don't own.
- **Forgotten**
  - In the event that you no longer want to remember or track a device, you can use the `forgetDevice()` API to remove this device from being both remembered and tracked.
</InlineFilter>

<InlineFilter filters={['android']}>
<Callout>

The [device tracking and remembering](https://aws.amazon.com/blogs/mobile/tracking-and-remembering-devices-using-amazon-cognito-your-user-pools/) features are currently not available within the library when using the federated OAuth flow with Cognito User Pools or Hosted UI.

</Callout>

Remembering a device is useful in conjunction with Multi-Factor Authentication (MFA). If MFA is enabled for an Amazon Cognito user pool, end users have to type in a security code received via e-mail or SMS each time they want to sign in. This increases security but comes at the expense of the user's experience.

Remembering a device allows the second factor requirement to be automatically met when the user signs in on that device, thereby reducing friction in the user experience.

## Configure Auth Category

To enable remembered device functionality, open the [Amazon Cognito over AWS console](https://console.aws.amazon.com/cognito).

When the console opens, scroll down to the **Device Tracking** section and select the `Edit` button. This will render the following page allowing you to configure your preference for remembering a user's device.

![Edit device tracking options list is shown, with the don't remember highlighted.](/images/auth/webconsole_remember1.png)

**Choose either Always remember or User Opt-in** depending on whether you want to remember a user's device by default or give the user the ability to choose.

If MFA is enabled for the Cognito user pool, you will have the option to suppress the second factor during multi-factor authentication. **Choose Yes** if you want a remembered device to be used as a second factor mechanism or **No** otherwise.

![Options for allow users to bypass MFA for trusted devices.](/images/auth/webconsole_remember2.png)

When you have made your selection(s), click "Save changes". You are now ready to start updating your code to manage your remembered devices.

## APIs

### Remember Device

You can mark your device as remembered:

<BlockSwitcher>
<Block name="Java">

```java
Amplify.Auth.rememberDevice(
    () -> Log.i("AuthQuickStart", "Remember device succeeded"),
    error -> Log.e("AuthQuickStart", "Remember device failed with error " + error.toString())
);
```

</Block>
<Block name="Kotlin - Callbacks">

```kotlin
Amplify.Auth.rememberDevice(
    { Log.i("AuthQuickStart", "Remember device succeeded") },
    { Log.e("AuthQuickStart", "Remember device failed with error", it) }
)
```

</Block>
<Block name="Kotlin - Coroutines">

```kotlin
try {
    Amplify.Auth.rememberDevice()
    Log.i("AuthQuickStart", "Remember device succeeded")
} catch (error: AuthException) {
    Log.e("AuthQuickStart", "Remember device failed with error", error)
}
```

</Block>
<Block name="RxJava">

```java
RxAmplify.Auth.rememberDevice()
    .subscribe(
      () -> Log.i("AuthQuickStart", "Remember device succeeded"),
      error -> Log.e("AuthQuickStart", "Remember device failed with error " + error.toString())
    );
```

</Block>
</BlockSwitcher>
### Forget Device

You can forget your device by using the following API. Note that forgotten devices are neither remembered nor tracked. See below for the difference between remembered, forgotten and tracked.

<BlockSwitcher>
<Block name="Java">

```java
Amplify.Auth.forgetDevice(
    () -> Log.i("AuthQuickStart", "Forget device succeeded"),
    error -> Log.e("AuthQuickStart", "Forget device failed with error " + error.toString())
);
```

</Block>
<Block name="Kotlin - Callbacks">

```kotlin
Amplify.Auth.forgetDevice(
    { Log.i("AuthQuickStart", "Forget device succeeded") },
    { Log.e("AuthQuickStart", "Forget device failed with error", it) }
)
```

</Block>
<Block name="Kotlin - Coroutines">

```kotlin
try {
    Amplify.Auth.forgetDevice()
    Log.i("AuthQuickStart", "Forget device succeeded")
} catch (error: AuthException) {
    Log.e("AuthQuickStart", "Forget device failed with error", error)
}
```

</Block>
<Block name="RxJava">

```java
RxAmplify.Auth.forgetDevice()
    .subscribe(
      () -> Log.i("AuthQuickStart", "Forget device succeeded"),
      error -> Log.e("AuthQuickStart", "Forget device failed with error " + error.toString())
    );
```

</Block>
</BlockSwitcher>

### Fetch Devices

You can fetch a list of remembered devices by using the following:

<BlockSwitcher>
<Block name="Java">

```java
Amplify.Auth.fetchDevices(
    devices -> {
        for (AuthDevice device : devices) {
            Log.i("AuthQuickStart", "Device: " + device);
        }
    },
    error -> Log.e("AuthQuickStart", "Fetch devices failed with error: " + error.toString()));
```

</Block>
<Block name="Kotlin - Callbacks">

```kotlin
Amplify.Auth.fetchDevices(
    { devices ->
        devices.forEach { Log.i("AuthQuickStart", "Device: " + it) }
    },
    { Log.e("AuthQuickStart", "Fetch devices failed with error", it) }
)
```

</Block>
<Block name="Kotlin - Coroutines">

```kotlin
try {
    Amplify.Auth.fetchDevices().forEach { device ->
        Log.i("AuthQuickStart", "Device: $device")
    }
} catch (error: AuthException) {
    Log.e("AuthQuickStart",  "Fetch devices failed with error", error)
}
```

</Block>
<Block name="RxJava">

```java
RxAmplify.Auth.fetchDevices()
    .subscribe(
        device -> Log.i("AuthQuickStart", "Device: " + device);
        error -> Log.e("AuthQuickStart", "Fetch devices failed with error: " + error.toString())
    );
```

</Block>
</BlockSwitcher>

## Terminology

- **Tracked**
  - Every time the user signs in with a new device, the client is given the device key at the end of a successful authentication event. We use this device key to generate a salt and password verifier which is used to call the ConfirmDevice API. At this point, the device is considered to be **tracked**. Once the device is in a tracked state, you can use the Amazon Cognito console to see the time it started to be tracked, last authentication time, and other information about that device.
- **Remembered**
  - Remembered devices are also tracked. During user authentication, the device key and secret pair assigned to a remembered device is used to authenticate the device to verify that it is the same device that the user previously used to sign in.
- **Not Remembered**
  - A not-remembered device is a tracked device where Cognito has been configured to require users to "Opt-in" to remember a device, but the user has not opt-ed in to having the device remembered. This use case is used for users signing into their application from a device that they don't own.
- **Forgotten**
  - In the event that you no longer want to remember or track a device, you can use the `Auth.forgetDevice()` API to remove this device from being both remembered and tracked.
</InlineFilter>

<InlineFilter filters={['flutter']}>
<Callout>

The [device tracking and remembering](https://aws.amazon.com/blogs/mobile/tracking-and-remembering-devices-using-amazon-cognito-your-user-pools/) features are currently not available within the library when using the federated OAuth flow with Cognito User Pools or Hosted UI.

</Callout>

Remembering a device is useful in conjunction with Multi-Factor Authentication (MFA). If MFA is enabled for an Amazon Cognito user pool, end users have to type in a security code received via e-mail or SMS each time they want to sign in. This increases security but comes at the expense of the user's experience.

Remembering a device allows the second factor requirement to be automatically met when the user signs in on that device, thereby reducing friction in the user experience.

## Configure Auth Category

To enable remembered device functionality, open the [Amazon Cognito over AWS console](https://console.aws.amazon.com/cognito).

When the console opens, scroll down to the **Device Tracking** section and select the `Edit` button. This will render the following page allowing you to configure your preference for remembering a user's device.

![Edit device tracking options list is shown, with the don't remember highlighted.](/images/auth/webconsole_remember1.png)

**Choose either Always remember or User Opt-in** depending on whether you want to remember a user's device by default or give the user the ability to choose.

If MFA is enabled for the Cognito user pool, you will have the option to suppress the second factor during multi-factor authentication. **Choose Yes** if you want a remembered device to be used as a second factor mechanism or **No** otherwise.

![Options for allow users to bypass MFA for trusted devices.](/images/auth/webconsole_remember2.png)

When you have made your selection(s), click "Save changes". You are now ready to start updating your code to manage your remembered devices.

## APIs

### Remember Device

You can mark your device as remembered:

```dart
Future<void> rememberCurrentDevice() async {
  try {
    await Amplify.Auth.rememberDevice();
    safePrint('Remember device succeeded');
  } on AuthException catch (e) {
    safePrint('Remember device failed with error: $e');
  }
}
```
### Forget Device

You can forget your device by using the following API. Note that forgotten devices are neither remembered nor tracked. See below for the difference between remembered, forgotten and tracked.

<br/>
<BlockSwitcher>
<Block name="Current Device">

```dart
Future<void> forgetCurrentDevice() async {
  try {
    await Amplify.Auth.forgetDevice();
    safePrint('Forget device succeeded');
  } on AuthException catch (e) {
    safePrint('Forget device failed with error: $e');
  }
}
```

</Block>
<Block name="Specific Device">

```dart
// A device that was fetched via Amplify.Auth.fetchDevices()
Future<void> forgetSpecificDevice(AuthDevice myDevice) async {
  try {
    await Amplify.Auth.forgetDevice(myDevice);
    safePrint('Forget device succeeded');
  } on AuthException catch (e) {
    safePrint('Forget device failed with error: $e');
  }
}
```

</Block>
</BlockSwitcher>

### Fetch Devices

You can fetch a list of remembered devices by using the following:

```dart
Future<void> fetchAllDevices() async {
  try {
    final devices = await Amplify.Auth.fetchDevices();
    for (final device in devices) {
      safePrint('Device: $device');
    }
  } on AuthException catch (e) {
    safePrint('Fetch devices failed with error: $e');
  }
}
```


## Terminology

- **Tracked**
  - Every time the user signs in with a new device, the client is given the device key at the end of a successful authentication event. We use this device key to generate a salt and password verifier which is used to call the ConfirmDevice API. At this point, the device is considered to be **tracked**. Once the device is in a tracked state, you can use the Amazon Cognito console to see the time it started to be tracked, last authentication time, and other information about that device.
- **Remembered**
  - Remembered devices are also tracked. During user authentication, the device key and secret pair assigned to a remembered device is used to authenticate the device to verify that it is the same device that the user previously used to sign in.
- **Not Remembered**
  - A not-remembered device is a tracked device where Cognito has been configured to require users to "Opt-in" to remember a device, but the user has not opt-ed in to having the device remembered. This use case is used for users signing into their application from a device that they don't own.
- **Forgotten**
  - In the event that you no longer want to remember or track a device, you can use the `Auth.forgetDevice()` API to remove this device from being both remembered and tracked.
</InlineFilter>

<InlineFilter filters={['swift']}>
<Callout>

The [device tracking and remembering](https://aws.amazon.com/blogs/mobile/tracking-and-remembering-devices-using-amazon-cognito-your-user-pools/) features are currently not available within the library when using the federated OAuth flow with Cognito User Pools or Hosted UI.

</Callout>

Remembering a device is useful in conjunction with Multi-Factor Authentication (MFA). If MFA is enabled for an Amazon Cognito user pool, end users have to type in a security code received via e-mail or SMS each time they want to sign in. This increases security but comes at the expense of the user's experience.

Remembering a device allows the second factor requirement to be automatically met when the user signs in on that device, thereby reducing friction in the user experience.

## Configure Auth Category

To enable remembered device functionality, open the [Amazon Cognito over AWS console](https://console.aws.amazon.com/cognito).

When the console opens, scroll down to the **Device Tracking** section and select the `Edit` button. This will render the following page allowing you to configure your preference for remembering a user's device.

![Edit device tracking options list is shown, with the don't remember highlighted.](/images/auth/webconsole_remember1.png)

**Choose either Always remember or User Opt-in** depending on whether you want to remember a user's device by default or give the user the ability to choose.

If MFA is enabled for the Cognito user pool, you will have the option to suppress the second factor during multi-factor authentication. **Choose Yes** if you want a remembered device to be used as a second factor mechanism or **No** otherwise.

![Options for allow users to bypass MFA for trusted devices.](/images/auth/webconsole_remember2.png)

When you have made your selection(s), click "Save changes". You are now ready to start updating your code to manage your remembered devices.

## APIs

### Remember Device

You can mark your device as remembered:


<BlockSwitcher>

<Block name="Async/Await">

```swift
func rememberDevice() async {
    do {
        try await Amplify.Auth.rememberDevice()
        print("Remember device succeeded")
    } catch let error as AuthError {
        print("Remember device failed with error \(error)")
    } catch {
        print("Unexpected error: \(error)")
    }
}
```

</Block>

<Block name="Combine">

```swift
func rememberDevice() -> AnyCancellable {
    Amplify.Publisher.create {
        try await Amplify.Auth.rememberDevice()
    }.sink {
            if case let .failure(authError) = $0 {
                print("Remember device failed with error \(authError)")
            }
        }
        receiveValue: {
            print("Remember device succeeded")
        }
}
```

</Block>

</BlockSwitcher>

### Forget Device

You can forget your device by using the following API. Note that forgotten devices are neither remembered nor tracked. See below for the difference between remembered, forgotten and tracked.

<BlockSwitcher>

<Block name="Async/Await">

```swift
func forgetDevice() async {
    do {
        try await Amplify.Auth.forgetDevice()
        print("Forget device succeeded")
    } catch let error as AuthError {
        print("Forget device failed with error \(error)")
    } catch {
        print("Unexpected error: \(error)")
    }  
}
```

</Block>

<Block name="Combine">

```swift
func forgetDevice() -> AnyCancellable {
    Amplify.Publisher.create {
        try await Amplify.Auth.forgetDevice()
    }.sink {
            if case let .failure(authError) = $0 {
                print("Forget device failed with error \(authError)")
            }
        }
        receiveValue: {
            print("Forget device succeeded")
        }
}
```

</Block>

</BlockSwitcher>

### Fetch Devices

You can fetch a list of remembered devices by using the following:

<BlockSwitcher>

<Block name="Async/Await">

```swift
func fetchDevices() async {
    do {
        let fetchDeviceResult = try await Amplify.Auth.fetchDevices()
        for device in fetchDeviceResult {
            print(device.id)
        }
    } catch let error as AuthError {
        print("Fetch devices failed with error \(error)")
    } catch {
        print("Unexpected error: \(error)")
    }
}
```

</Block>

<Block name="Combine">

```swift
func fetchDevices() -> AnyCancellable {
    Amplify.Publisher.create {
        try await Amplify.Auth.fetchDevices()
    }.sink {
            if case let .failure(authError) = $0 {
                print("Fetch devices failed with error \(authError)")
            }
        }
        receiveValue: { fetchDeviceResult in
            for device in fetchDeviceResult {
                print(device.id)
            }
        }
}
```

</Block>

</BlockSwitcher>

## Terminology

- **Tracked**
  - Every time the user signs in with a new device, the client is given the device key at the end of a successful authentication event. We use this device key to generate a salt and password verifier which is used to call the ConfirmDevice API. At this point, the device is considered to be **tracked**. Once the device is in a tracked state, you can use the Amazon Cognito console to see the time it started to be tracked, last authentication time, and other information about that device.
- **Remembered**
  - Remembered devices are also tracked. During user authentication, the device key and secret pair assigned to a remembered device is used to authenticate the device to verify that it is the same device that the user previously used to sign in.
- **Not Remembered**
  - A not-remembered device is a tracked device where Cognito has been configured to require users to "Opt-in" to remember a device, but the user has not opt-ed in to having the device remembered. This use case is used for users signing into their application from a device that they don't own.
- **Forgotten**
  - In the event that you no longer want to remember or track a device, you can use the `Auth.forgetDevice()` API to remove this device from being both remembered and tracked.

</InlineFilter>
