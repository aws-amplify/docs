export const meta = {
  title: 'Special input fields',
  description:
    'Special input fields in Amplify Studio form builder allow the user to interact with unique Amplify features'
};

Amplify Studio's Form Builder has some input fields with special configurations available. 

## Storage Manager

**Storage Manager** fields allow your forms to accept file uploads, which are stored in an Amazon S3 bucket connected to your Amplify app. After uploading, that file's S3 key is stored in your data model, allowing for systematic retrieval using the [Amplify JS library](/lib/storage/download/q/platform/js/). 

(screenshot or gif of using the Storage Manager input)

### Prerequisites

In order to use the Storage Manager field, your Amplify app must meet some prerequisites:
* You must have an [Amplify app with Studio enabled](/console/adminui/start/)
* You must have Amplify Authentication, [either through Studio](/auth/authentication/) or [through the CLI](/cli/auth/overview/)
* You must have added Amplify Storage to your app, either [through Studio](/console/storage/file-storage/) or [through the CLI](/cli/storage/overview/)

### How it works

The Storage Manager input in Form Builder will allow the form submitter to select from files on their local device and upload them to an S3 bucket. Storage Manager automatically connects to your S3 bucket added as part of Amplify Storage, and uses the same [File level access concepts](#file-level-access), defaulting to `private`. 

Files are uploaded immediately upon selection, and an S3 key is generated. By default, Storage Manager will generate a [unique S3 key](#unique-s3-keys) based on the file uploaded. On form submission, Storage Manager will return the S3 key of the uploaded file as a `String`. 

If your Storage Manager field is connected to a field in your data model, the S3 key will be written to your database via your GraphQL API. If the field is not connected to a data model, you can [handle the S3 key manually with the `onSubmit` hook](/console/formbuilder/lifecycle/#handle-form-data-submissions---onsubmit).

### Storage Manager with connected forms

A **connected form** is a form built with Amplify Studio that is bound to your data model - when the form is submitted, a record is created or updated in the bound data model. 

When a Storage Manager input field is added to a connected form, the S3 key of the uploaded file is written to a `String` field in the connected data model. 

*Prerequisites:*
* You must have a GraphQL API, deployed either [through Studio](/console/data/data-model/) or [through the CLI](/cli/graphql/overview/).
* You must have at least one field in your data model with a type of `String`
* You must have a connected form. This can be a [default form](/formbuilder/overview/#option-1-use-auto-generated-forms), or a [custom form that starts with a Data model](/formbuilder/overview/#option-2-build-a-form-from-scratch)


*Add Storage Manager to a connected form...*
1. [Log into your Studio app](/console/adminui/start/) and select the UI Library

(screenshot)

2. Select a connected form and select **Configure** in the upper right-hand corner

(screenshot)

3. Select the `string` field you would like to convert to a Storage Manager field

(screenshot)

4. In the **Display** section of the **Input settings** sidebar, select the **Type** dropdown and choose `StorageField`

(screenshot)

<Callout info>

Only `String` type fields can be converted to a `StorageField` type. If the **Type** dropdown is missing `StorageField`, [check your data model](/console/data/data-model/)

</Callout>

### Storage Manager with custom forms

*Add a Storage Manager field to a custom form...*
1. [Log into your Studio app](/console/adminui/start/) and select the UI Library

(screenshot)

2. Navigate to a custom form, or [create a new blank form](/formbuilder/overview/#option-2-build-a-form-from-scratch)

(screenshot)

3. Click the blue plus sign to add a new field to your form 

(screenshot)

4. Select a `StorageField` input element

(screenshot)

With all custom forms, the form submission must be configured manually. Use the `onSubmit` hook and the `fields` object to [handle submission in code](/console/formbuilder/lifecycle/#handle-form-data-submissions---onsubmit). 

### Configuring Storage Manager

Storage Manager has several unique configurations that can be applied in the right-hand toolbar. 

* **File level access**: determines which users can access the uploaded file. Storage Manager will default to Private.
    * *Private*: only accessible to the uploader
    * *Protected*: accessible to any authenticated user
    * *Public*: accessible to anyone
* **Accepted file types**: limits which file types can be uploaded
* **Advanced settings**
    * **Maximum number of files**: max number of files that can be added to the form before submission. If your bound data model field is not an array, this will always be 1
    * **Maximum file size**: max size for each file uploaded
    * **Is pausable**: allows the user to pause and resume the upload
    * **Preview image**: if the uploaded file is an image, a preview of the image will be rendered in your form

### File level access

Storage Manager uses the same [File level access concepts](/lib/storage/configureaccess/q/platform/js/) as the Storage category, defaulting to `private`. If you select `private` or `protected` file level access, all files uploaded will have `{user_identity_id}` in the file path. This restricts Read and Write access, and ensures identical files uploaded by different users have unique paths. 


### Unique S3 keys

If files with identical S3 keys are uploaded to the same path, S3 will overwrite those files. To prevent accidental overwriting of files, Storage Manager generates a unique S3 key by hashing the *file contents*. Uploading different files with the same name will not overwrite the original file. 

However, if a form submitter uploads two identical files to the same path - even with different file names - Storage Manager will prevent file duplication in your S3 bucket. 

<Callout warning>

File overwriting only occurs for identical S3 keys *in the same path*. If the **File level access** for your Storage Manager is set to `private` or `protected`, identical files uploaded by separate users will be saved separately. 

If your **File level access** is set to `public`, identical files will overwrite each other.

</Callout>