[comment]: # (The title is generated as part of the meta of the page under rc > pages > lib > auth > set_up_auth)

In this guide, you will learn how to set up Amplify Authentication. This guide includes setting up and connecting your backend resources, and enabling sign-up, sign-in, and sign-out. We will also provide more context on how resources are managed and created with Amplify to help you make decisions and understand any long-term impact of those decisions for your use case. If you are new to Amplify Authentication, you can get a [high-level overview](https://aws.amazon.com/amplify/authentication/) of the features before getting started.

## Set up and connect to backend resources

In this guide you will set up and connect to your backend resources. This includes understanding how resources are managed and created to help you choose a management path. We will also look at how your security strategy and password formats may influence some of your choices. 

> **Before you begin, you will need:**
> - [Node.js](https://nodejs.org/) v14.x or later
> - [npm](https://www.npmjs.com/) v6.14.4 or later
> - [git](https://git-scm.com/) v2.14.1 or later

[comment]: # (Links for node, npm, and git above from https://github.com/aws-amplify/docs/blob/main/src/fragments/start/getting-started/common/prereq.mdx; but we will need to update these fragments to use them as broader in scope than what we need here.)

[note]: # (In our workshop we called out that users may experience problems setting up the CLI but I did not put that section here b/c it read like it should be part of the CLI instructions. If this troubleshooting is specific to Auth let’s look at adding in an Expander here.)

### Deciding how to create and manage your backend resources

[comment]: # (This section includes an updated overview that helps the user to decide which management method to use. This includes an explanation of how resources are managed and created; the benefits of using Amplify CLI and Studio to get Amplify features and functionality; how Cognito is used today; security strategy choices; and password formats. This content should help them understand required decisions for the job before they get started on the actions. Current content from - https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/getting-started.mdx Additional INSPIRATION from https://docs.amplify.aws/lib/auth/overview/q/platform/js/ and https://docs.amplify.aws/cli/auth/overview/)

You can create and manage your Authentication resources with Amplify by using the Amplify CLI, Amplify Studio, or create them outside of Amplify and use the Amplify Libraries to connect your application to the resources. The most common way is via the Amplify CLI, which allows you to create new Amazon Cognito resources or import existing ones. However, you can also use the Amplify Studio console to configure authentication or use the `Amplify.configure()` method to set up authentication with existing resources via the Amplify Libraries. 

We recommend using Amplify CLI or Amplify Studio when creating and deploying your Authentication resources (Cognito user pools, IAM roles, etc.) as these tools will help you with resource provisioning, IAM policies and roles for resources, deployments, local testing, continuous integration and deployment (CI/CD), and environment management.

*Amplify Libraries can be used to integrate your existing Authentication resources into your app code but this is limited to interacting with provisioned resources individually and is better suited for basic prototyping and small projects. ( **Not sure what this sentence is meant to convey?**)*

#### What is you Sign In strategy? - Plain, Federated, MFA, or Mixed
EXPANDER_START

[comment]: # (EXPANDER section that provides a foundational look at security strategies and how Amplify aligns to those choices. We had put this as a need-to-know initially so once written we may consider if this should be taken out of the expander. Content from https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/overview.mdx and INSPIRATION from  https://docs.amplify.aws/lib/auth/getting-started/q/platform/js/ , https://docs.amplify.aws/lib/auth/overview/q/platform/js/ , https://docs.amplify.aws/lib/auth/mfa/q/platform/js/ )

Amplify Authentication helps you secure your application while providing an easy sign-in experience for your users. This experience will be influenced by your security strategy. This security strategy will include both the authentication method, security credentials, and enabling additional verification when needed.

 - *Authentication* is a process to validate **who you are** (abbreviated as *AuthN*). The system which does this validation is referred to as an **Identity Provider** or **IdP**. This can be your own self-hosted IdP or a cloud service. Oftentimes, this IdP is a social provider such as Facebook, Google, or Amazon.
 - *Authorization* is the process of validating **what you can access** (abbreviated as *AuthZ*). This is sometimes done by looking at tokens with custom logic, predefined rules, or signed requests with policies.

Common authentication methods and associated risks include: 
1. username/password which is simple to set up but prone to compromise, 
2. social provider federation which shares data with third parties, and 
3. multi-factor authentication which adds a layer of security at sign-in but also adds friction for your users.

You can improve security credentials and verification for these authentication methods by adding: 
1. password policies that ensure stronger passwords created by your users, 
2. require additional contact information from users before they can reset passwords, 
3. limit sign-in attempts to prevent brute-force logins, and 4) enable temporary passwords for MFA flows to improve user verification.

[comment]: # (End of expander section)

EXPANDER_END

In the Amplify ecosystem, the most common Authentication method is either using Amazon Cognito User Pools independently or with a social provider to validate the identity of the user (known as *Federation*). 

Amplify uses [Amazon Cognito](https://aws.amazon.com/cognito/) as the main authentication provider. Amazon Cognito is a robust user directory service that handles user registration, authentication, account recovery, and other operations. You will be able to work with Amazon Cognito with each of the management methods. If you have not worked with Amazon Cognito before we recommend taking a closer look at Amazon Cognito configuration decisions before you continue.

#### Understanding Amazon Cognito configuration decisions

EXPANDER_START

[comment]: # (EXPANDER section that details decisions with Cognito that cannot change in the long-term such as: user attributes cannot be renamed or deleted; login methods - username/email/phone/alias - cannot be added or changed; standard attributes which are required cannot be changed; enabling MFA after it was disabled is not possible. INSPIRATION from https://docs.aws.amazon.com/cognito/latest/developerguide/what-is-amazon-cognito.html I also used a few additional pages: https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html and https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html)

Amazon Cognito can be customized based on your security strategy for authentication. However, there are some initial configuration options that cannot be changed after the backend resources are deployed (or maybe configured):

- User attributes that are used to identify your individual users (e.g. username, email, etc.) cannot be renamed or deleted.
- Login methods (including username, email, phone, etc.) cannot be added or changed after the initial configuration. This includes both defining which attributes are used to log-in and which attributes are required. Required attributes must have a value for all users once set.
- Verification methods (including username, email, etc.) are the same as required attributes and cannot be removed once configured.
- The encryption setting is set once the user pool is launched and cannot be changed to encrypt/decrypt after that point.
- The ‘sub’ attribute is a unique identifier within each user pool that cannot be modified and can be used to index and search users.
- *MFA type "SMS, TOTP" is set if selected when the user pool is created and cannot be disabled or changed to an unsupported option "e.g. push notification" once it is enabled. Additionally, if MFA is set to required for all users or certain groups this requirement cannot be disabled later on.*

See the [Amazon Cognito documentation]( https://docs.aws.amazon.com/cognito/latest/developerguide/what-is-amazon-cognito.html) for more details on these settings including [User pool attributes](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html) and [Adding MFA to a user pool](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html).

[comment]: # (End of expander section.)

EXPANDER_END

### Set up and configure your auth category

[comment]: # (Content consolidated so we can review as a whole and update as needed as a whole. Sources include: https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/getting_started/10_setUpBackendResources.mdx and https://github.com/aws-amplify/docs/blob/JTBD-Auth/src/fragments/lib/auth/js/getting-started-steps-basic-auth.mdx)

[question]: # (Can we add more information about what is included in the different default configurations? This example asks them to use default but what does that include? Thinking of options of - default configuration, default with social provider, manual configuration. Where can I find this information to add into an expander?)

Once you have chosen your management method you can configure your auth category by installing the library and configuring the Auth category. 

#### Install the Amplify Libraries

To install the Amplify Libraries, run the following command:

```bash
npm install aws-amplify
```

#### Understanding password formats

[comment]: # (EXPANDER section that provides more information on password formats – length, characters, etc. INSPIRATION from https://docs.amplify.aws/lib/auth/manageusers/q/platform/js/ It looks like from the switchers that only Studio requires these decisions this early do we want to move this information to that switcher specifically or do we need to update this for both “create” options?)

When you are setting up your password formats for authentication you will want to consider the following best practices:

- Password strength: You can set minimum length, character types, *and prevent common words or sequences to help users make stronger passwords. This can include an expiration period to help your users update their password regularly (e.g. every 90 days). There are also options to limit repeated passwords by making sure it is not one of the previous X passwords. Finally, if you have MFA enabled, you can use temporary passwords to add more verification. (**This reads like Cognito can do this, which it doesn’t out the box. May need to clarify this sentence**)*
- Forgotten passwords: You have the option to require additional verified contact information (e.g. email, phone) or use a validation code in the reset flow. You can also track password resets in your logs (e.g AWS CloudTrail) to check for suspicious activity.
- *Lockout settings: You can set the number of incorrect sign-in attempts you allow within a specific time frame (min/hours) for you users. You can also check for unverified devices and require additional validation when your user’s device changes.*

[comment]: # (End of expander section.)

#### Set up your auth/backend resources

<BlockSwitcher>
<Block name="Amplify CLI (Create)">

> Prerequisites: [Install and configure](/lib/project-setup/prereq/q/platform/js/) the Amplify CLI and have an existing app or create a new one with `amplify init`

To start provisioning auth resources in the backend, go to your project directory and **execute the command**:

```bash
amplify add auth
```

```console
? Do you want to use the default authentication and security configuration? Default configuration
? How do you want users to be able to sign in? Username
? Do you want to configure advanced settings?  No, I am done.
```
The above prompts will setup a default configuration for you. This includes:
- Username as the sign-in method
- Default password policy
- No MFA enabled
- No 3rd party social providers enabled

If you want to configure advanced settings, you can choose the `Manual configuration` option. The CLI prompts will help you to customize your auth flow for your app. With the provided options, you can:
- Customize sign-in/registration flow
- Customize email and SMS messages for Multi-Factor Authentication
- Customize attributes for your users, e.g. name, email
- Enable custom auth flows
- Enable Cognito Lambda triggers
- Enable 3rd party social providers, e.g. Facebook, Twitter, Google and Amazon


> If you wish to federate with social providers [you will need to configure them on the provider end first](/lib/auth/social#social-providers-and-federation).


After configuring your Authentication options, update and deploy the backend by running the `push` command:

```bash
amplify push
```

Now, the authentication service has been deployed and you can start using it. To view the deployed services in your project at any time, go to Amplify Console by running the following command:

```bash
amplify console
```

In your app's entry point (i.e. **App.js**, **index.js**, **_app.js**, or **main.js**), import and load the configuration file:

```javascript
import { Amplify, Auth } from 'aws-amplify';
import awsconfig from './aws-exports';
Amplify.configure(awsconfig);
```
This will bootstrap you app to use Amplify with the deployed backend resources.

</Block>

<Block name="Amplify CLI (Import)">

> Prerequisites: [Install and configure](/lib/project-setup/prereq/q/platform/js/) the Amplify CLI and have an existing app or create a new one with `amplify init`

To import existing Amazon Cognito resources into your Amplify project, **execute the command**:

```bash
amplify import auth
```
```console
? What type of auth resource do you want to import?
   Cognito User Pool and Identity Pool
   Cognito User Pool only
```

Once you've selected an option, you'll be able to search for and import an existing Cognito User Pool and Identity Pool (or User Pool only) within your AWS account.  The `amplify import auth` command will also do the following:
- Automatically populate your Amplify Library configuration files (`aws-exports.js`, `amplifyconfiguration.json`) with your chosen Amazon Cognito resource information
- Provide your designated existing Cognito resource as the authentication & authorization mechanism for all auth-dependent categories (API, Storage and more)
- Enable Lambda functions to access the chosen Cognito resource if you permit it

After configuring your Authentication options, update your backend and deploy the service by running the `push` command:

```bash
amplify push
```

Now, the authentication service has been deployed and you can start using it. To view the deployed services in your project at any time, go to Amplify Console by running the following command:

```bash
amplify console
```

In your app's entry point (i.e. **App.js**, **index.js**, **_app.js**, or **main.js**), import and load the configuration file:

```javascript
import { Amplify, Auth } from 'aws-amplify';
import awsconfig from './aws-exports';
Amplify.configure(awsconfig);
```

This will bootstrap you app to use Amplify with the deployed backend resources.

</Block>

<Block name="Amplify Studio"> 

> Prerequisites: [Install and configure](/lib/project-setup/prereq/q/platform/js/) the Amplify CLI and have an existing app or create a new one with `amplify init`

Amplify Studio allows you create auth resources, set up authorization rules, implement Multi-factor authentication (MFA), and more via an intuitive UI. To set up Authentication through the Amplify Studio, take the following steps: 

1. **Sign in** to the [AWS Management Console](https://console.aws.amazon.com/console/home) and open AWS Amplify.
2. In the navigation pane, **choose an application** or create a new one by choosing **New app** and selecting **Build an app**.
- For a new app, enter a name for your app, then choose **Create app**. It will take a few minutes to create the app environment.
- For an existing app, choose the **Backend environments** tab, then choose **Launch Studio** (or **Setup Studio** if you app isn't configured with studio yet) under the environment you are working with.
3. On the **Set up** menu, choose **Authentication**.
4. In the **Configure log in** section, choose a login mechanism to add from the **Add login mechanism** list. Valid options are _Username_, _Phone number_, _Facebook_, _Google_, _Amazon_, and _Sign in with Apple_. If you choose one of the social sign-in mechanisms (i.e. _Facebook_, _Google_, _Amazon_, or _Sign in with Apple_), you will also need to enter your _App ID_, _App Secret_, and redirect URLs.
5. (Optional) Add multi-factor authentication (MFA). MFA is set to **Off** by default. To turn on MFA, do the following in the **Multi-factor authentication** section:
* Choose **Enforced** to require MFA for all users or choose **Optional** to allow individual users to enable MFA.
* (Optional) Choose **SMS**, and enter your SMS message.
* (Optional) Choose **Authenticator Application** if you want your app to load with an authentication flow that includes sign up and sign in.
6. In the **Configure sign up** section, expand **Password protection settings** and customize the password policy settings to enforce. u6. Choose **Save and Deploy**. This starts a CloudFormation deployment with the progress displayed in the upper right corner of the page.
7. After creating and configuring your auth resources, you'll need to pull them down from Amplify Studio.  To do so, simply click on "Local setup instructions" in the upper right hand corner of the Studio console and execute the CLI command it provides at the root directory of your app. 

> You can also [import](https://docs.amplify.aws/console/auth/import/) existing Amazon Cognito resources and [manage users and groups](https://docs.amplify.aws/console/auth/user-management/) through the Amplify Studio UI. 

</Block>

<Block name="Existing Resources">

Existing Authentication resources from AWS (e.g. Amazon Cognito UserPools or Identity Pools) can be used with the Amplify Libraries by calling the `Amplify.configure()` method. 

In your app's entry point (i.e. **App.js**, **index.js**, **_app.js**, or **main.js**), import and load the configuration file:

```javascript
import { Amplify, Auth } from 'aws-amplify';

Amplify.configure({
  Auth: {
    // REQUIRED only for Federated Authentication - Amazon Cognito Identity Pool ID
    identityPoolId: 'XX-XXXX-X:XXXXXXXX-XXXX-1234-abcd-1234567890ab',

    // REQUIRED - Amazon Cognito Region
    region: 'XX-XXXX-X',

    // OPTIONAL - Amazon Cognito Federated Identity Pool Region
    // Required only if it's different from Amazon Cognito Region
    identityPoolRegion: 'XX-XXXX-X',

    // OPTIONAL - Amazon Cognito User Pool ID
    userPoolId: 'XX-XXXX-X_abcd1234',

    // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)
    userPoolWebClientId: 'a1b2c3d4e5f6g7h8i9j0k1l2m3',
  },
});


// You can get the current config object
const currentConfig = Auth.configure();
```
<Callout warning={true}>
If your existing UserPool client has a required attribute that is NOT set to mutable, you may face login issues when using Social sign in. To resolve this, you will need to <ExternalLink href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html">create a new UserPool client</ExternalLink> and mark the required attribute as mutable.
</Callout>


#### *OAuth configuration parameters:*
*These settings can be found in the Cognito User Pools console under **App Integration** section*
- *`domain`: This can be found in the **Domain name** sub section*
- *`scope`: Remember to have the scope allowed on the Cognito App client, this can be found on **App client settings** sub section*
- *`redirectSignIn`: URL must be present on **Callback URL(s)** , check on **App client settings** sub section*
- *`redirectSignOut`: URL must be present on **Sign out URL(s)**, check on **App client settings** sub section*
- *`responseType`: Option must be enabled on the App client, look for **Allowed OAuth Flows** on **App client settings** sub section. *Authorization code grant* is for 'code' value and *Implicit grant* is for 'token' value.*

</Block>
</BlockSwitcher>

### Recap

You now have set up and configured your backend resources for Amplify authentication. 

[comment]: # (ADD TO RECAP a tie-in to real-world use and application of the topic discussed OR reiterate the benefit. If not applicable delete this comment.)

## Determine your Auth integration path

Before you implement Auth you will want to evaluate the options of using Authenticator UI component, Amplify Libraries methods, or Cognito Hosted UI for your use case. We recommend using Authenticator as the easiest to implement. You can also use Authenticator together with Amplify Libraries methods to extend capabilities when needed.

> Before you begin, you will need to have set up and connected backend resources with a configured Auth category. (Is this needed?)

[Comment]: # (This whole section was marked to be expanded in our workshop – this section needs better detail. INSPIRATION below does not have accurate links but some digging did provide https://docs.amplify.aws/start/getting-started/auth/q/integration/react-native/#create-login-ui and https://docs.amplify.aws/start/getting-started/auth/q/integration/react/#create-login-ui and https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-integration.html#cognito-user-pools-app-integration-amplify and https://aws.amazon.com/blogs/security/use-the-hosted-ui-or-create-a-custom-ui-in-amazon-cognito/ )

### Compare implementation options

There are a few options to implement Auth depending on how much customization you will need:

- **Authenticator component** is a full featured open-source drop-in UI component for authentication that allows you to quickly add a production-ready authentication flows to web and mobile applications. It automatically integrates with your existing Amplify configuration and allows you to easily add the entire authentication flow to your application. You simply add the component to your app and have your app connect with the Amazon Cognito authentication configuration. You can then customize themes to adjust colors and styling as needed.
- **Amplify Libraries** provide the low-level building blocks for implementing authentication and give you full control over the UI and logic. However, the Amplify Libraries require more work to implement compared to the Authenticator.
- **Hosted UI** s a login page that is hosted by Cognito outside of your application that can be used for most basic authentication flows. It works by redirecting the user from your app to Hosted UI page when they begin the authentication flow. It will then redirect the user back to your application once the flow completes.

[comment]: # (Adding table view as an option. If we do a table instead of the bullets above we will need to revise the INSPIRATION Pros and Cons. Adding for easier consideration and editing.)

| Option | Description | Pros | Cons |
|:-:|:-:|:-:|:-:|
| Amplify Authenticator | Open source drop-in UI component for authentication | Allows you to quickly add a production-ready authentication flows to web and mobile applications. It automatically integrates with your existing Amplify configuration and allows you to easily add the entire authentication flow to your application. You simply add the component to your app and pass it your Amazon Cognito authentication configuration. You can then customize themes to adjust colors and styling as needed. | Dependent on Amplify CLI for provisioning resources. |  
| Amplify Libraries | Low-level building blocks for implementing authentication | Gives you full control over the UI and logic. | UI needs to be built and requires more work to implement a full end-to-end solution - you must manage resourcing and provisioning yourself. |
| Amplify Hosted UI | Pre-built sign-up and sign-in UI components | Simple drop-in UI with basic customization via properties. | *Has limited functionality (only sign-up and sign-in) and you will still need to manage backend integration and additional authentication workflows. For example, you will still need to integrate Amazon Cognito separately with the Amplify CLI as well as set up workflows for password reset, MFA, federation, and more.* |

We recommend using the authenticator to quickly set up your UI component and then use the Amplify Libraries to customize the user experience and logic.

### Recap

You should now have a better idea of which integration path will work for your use case for implementing Auth.

[comment]: # (ADD TO RECAP a tie-in to real-world use and application of the topic discussed OR reiterate the benefit. If not applicable delete this comment.)

## Enable sign-up, sing-in, sing-out, and verify a test account

In this section you will set up sign-up, sign-in, and sign-out and then test that this functionality is working. This includes a review of sign-up methods provided by Amplify, the specific user attributes used by Amazon Cognito, how to verify users (if needed for your use case), and the differences between local and global sign-out. This review will help inform decisions made as you add these authentication capabilities using your preferred implementation method - Authenticator, Amplify Libraries, or Hosted UI.

> **Before you begin, you will need:**
> - A front-end app
> - Set up and connected backend resources with a configured Auth category 
> - Decided your Auth implementation path

[Comment]: # (This section focuses on the learning outcomes users need to understand before the complete enabling sign-up etc. In order as it appears on the page, this includes: 1- compare the sign up methods provided by Amplify, 2- optional outcome in the expander for understanding how the sign-up workflow works. Since we merged the three jobs I’ve expanded this workflow to detail all stages. 3- understand Cognito user attributes and which can be customized 4- Understand the difference between local and global sign-out. For the first few paragraphs a lot of the explainer content has INSPIRATION using several different URLs. For high-level verification I used: https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/overview.mdx ; https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/social.mdx ; https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/mfa.mdx ) 

Amplify offers several sign-up and sign-in methods out of the box. 
- The username/password method allows end-users to sign-up and sign-in to your application using a username (or email) and password of their choosing. It is enabled by default in your Amplify CLI Auth configuration. You can customize the sign-up and sign-in templates, specify attribute fields to include, enable verification, etc.
- The social sign-in method allows end-users to sign-in to your application using OAuth connections to Amazon, Apple, Facebook, Google, and more. This set up will include configuration of the provider name, client ID and other details.
- Multi-factor authentication (MFA) method adds an extra layer of security for sign-in. This can be set up with SMS text message or Time-based One-Time Password (TOTP) authentication. Once set up Amazon Cognito will verify the MFA code entered by the end-user before authentication succeeds.

For many apps, user sign-up and sign-in with a username/password is all that is required. Once authenticated, the app can talk to an API to access and mutate data. We will use the username/password authentication flow to get started. Both [third party social provider federation]( https://docs.amplify.aws/lib/auth/social/q/platform/js/) and [multi-factor authentication]( https://docs.amplify.aws/lib/auth/mfa/q/platform/js/) can be added after this initial set up.

[comment]: # (EXPANDER section to help users understand how the sign up workflow works. INSPIRATION was not limited to a specific URL for this section but included content from https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/overview.mdx ; https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/emailpassword.mdx. This would be a good place to diagram and provide a shorter description and image instead. If we do want an image I’m happy to create it but I first want to make sure the below is correct and do a rough outline sketch with an expert before creating it.)

### Review the sing-up, sign-in, and sign-out workflow

Below is a high-level overview of the workflows for sign-up, sign-in, and sign-out with Amplify authentication:

**Sign-up:** The username/password set up will ask your end-user for a username (or email) and a password. They will also be prompted for any custom attributes you include in your sign-up from such as address, birthdate, phone, etc. When your end-user submits this information, it is then passed through the `Auth.signUp()` method to your Amazon Cognito User Pool. If you have verification enabled, the end-user will receive a verification message via email and/or SMS. They must then enter the verification code to confirm their sign-up details are correct. Once the end-user is verified, their user profile is officially created in the Cognito User Pool. The profile contains the username, password, email, and any other custom attributes collected during sign-up. This user profile can then be used for authentication to sign-in and access your application.

**Sign-in:** The end-user enters their credentials (username/password) and submits the form in your application to sign-in. The application will then call the `Auth.signIn()` method to sign-in the end-user by passing the username/password to verify and establish a session with Amazon Cognito which will then generate the needed tokens to grant access. Again, if email verification is enabled, the end-user will first verify their email during their first sign-in before the tokens are issued and sign-in completes. Amazon Cognito issues temporary short-lived tokens on sign-in (default of 1 hour) but you can update these settings to keep the end-user signed in for longer (up to 24 hours).

**Sign-out:** Amplify uses the `Auth.signOut()` method to sign-out the end-user by ending the current session and revoking the tokens with Amazon Cognito. This clears the user session in the browser and the application will then navigate the end-user to the sign-in screen.

[comment]: # (End of expander section.)

### Decide before you build

Before you enable sign-up, sign-in, and sign-out there are a few decisions you will need to know to complete the process. 

#### Passing Amazon Cognito attributes for sign-up

User attributes (e.g. username, email, etc.) are used to identify your end-users. These are set up when you confiture your Cognito User Pool and cannot be renamed or deleted after they are configured. You will need to know which attributes were configured as required at set up (e.g. email) and make sure your end-user is prompted to enter this information. You can find this information in the Amazon Cognito console under the Sign-up experience tab. You can also add [additional User Pool attributes]( https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html) that are collected from the sign-up form. This includes attributes like address, birthdate, phone, etc. These attributes are not required by default. You can make these additional attributes required but it cannot be changed back to not required once configured.

[Question]: # (Is there a way to find attributes set up during the User Pool configuration via an API call if they want to quickly check without going into the console? May be good to add to the fourth sentence above.)

#### Verifying users at sign-up

You can require the end-user to verify their contact information before their account is activated. This verification is usually set up when configuring the Cognito User Pool. Only email and phone can be verified. Email verification asks the end-user to click a link sent to their email address provided during sign-up. Phone verification is done by asking the end-user to enter the code sent to them in a SMS text message. You do have the option to require both verification methods.

[Question]: # (Is this a default setting when configure Auth with the default setting or is this something they need to go into Cognito to set up separately?)

#### Determining if you need local or global sign-out

The default when passing the `Auth.signOut()` method is a local sign out. This will sign-out the end-user from a specific application or device and revokes the tokens used for authentication. If you need a global sign-out that revokes all associated tokens, credentials, and sessions across all applications and devices you update the method to `Auth.signOut({ global: true })` when using authenticator and Amplify Libraries and `GlobalSignOut` for Hosted UI.

[Comment]: # (Not sure about the local and global sign-out being here or if it should be added to the end of each option below since it does change.)

### Add the sign-up, sign-in, and sing-out capabilities

There are three ways to add authentication capabilities to your application: Authenticator, Amplify Libraries, or Hosted UI. Select from the options below to complete the steps to set up a simple password/username authentication for your application.
- [Use pre-built UI components with Authenticator](#option-1-use-pre-built-ui-components-with-authenticator) (recommended)
- [Call Authentication APIs manually with Amplify](#option-2-call-authentication-apis-manually-with-amplify-libraries) Libraries
- [Use pre-built Hosted UI with Amazon Cognito](#option-3-use-pre-built-hosted-ui-with-amazon-cognito)

#### Option 1: Use pre-built UI components with Authenticator

[comment]: # (This section is from https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/enable_sign_in_sign_up.mdx ; https://github.com/aws-amplify/docs/blob/main/src/fragments/ui/auth/react/withauthenticator.mdx ; )

Creating the login flow can be quite difficult and time consuming to get right. Amplify has authentication UI components you can use that will provide the entire authentication flow for you, using your configuration specified in your __aws-exports.js__ file.

Amplify has pre-built UI components for React, Vue, Angular and React Native.

<BlockSwitcher>
<Block name="React">

First, install the `@aws-amplify/ui-react` library as well as `aws-amplify` if you have not already:

```sh
npm install aws-amplify @aws-amplify/ui-react
```

Next, open __src/App.js__ and add the `withAuthenticator` component.

**withAuthenticator**

The `withAuthenticator` is a higher-order component (HoC) that wraps `Authenticator`. You'll also notice the `user` and `signOut` are provided to the wrapped component.

**Usage**

```jsx
import { Amplify } from 'aws-amplify';

import { withAuthenticator } from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css';

import awsExports from './aws-exports';
Amplify.configure(awsExports);

function App({ signOut, user }) {
  return (
    <>
      <h1>Hello {user.username}</h1>
      <button onClick={signOut}>Sign out</button>
    </>
  );
}

export default withAuthenticator(App);
```
</Block>
<Block name="Vue 3">

First, install the `@aws-amplify/ui-vue` library as well as `aws-amplify` if you have not already:

```bash
npm install aws-amplify @aws-amplify/ui-vue
```

Next, open __src/App.js__ and add the `Authenticator` component.

**Authenticator**

The `Authenticator` component offers a simple way to add authentication flows into your app. This component encapsulates an authentication workflow in the framework of your choice and is backed by the cloud resources set up in your Auth cloud resources. You’ll also notice that `user` and `signOut` are passed to the inner template.

```html
<script setup>
  import { Authenticator } from "@aws-amplify/ui-vue";
  import "@aws-amplify/ui-vue/styles.css";

  import { Amplify } from 'aws-amplify';
  import awsconfig from './aws-exports';

  Amplify.configure(awsconfig);
</script>

<template>
  <authenticator>
    <template v-slot="{ user, signOut }">
      <h1>Hello {{ user.username }}!</h1>
      <button @click="signOut">Sign Out</button>
    </template>
  </authenticator>
</template>
```

</Block>
<Block name="Vue 2">

First, install the `@aws-amplify/ui-components` library as well as `aws-amplify` if you have not already:

```bash
npm install aws-amplify @aws-amplify/ui-components
```

Now open __src/main.js__ and add the following below your last import:

```js
import '@aws-amplify/ui-components';
import {
  applyPolyfills,
  defineCustomElements,
} from '@aws-amplify/ui-components/loader';
import Vue from 'vue';

Vue.config.ignoredElements = [/amplify-\w*/];


applyPolyfills().then(() => {
  defineCustomElements(window);
});
```

Next, open __src/App.js__ and add the `amplify-authenticator` component.

**amplify-authenticator**

The `amplify-authenticator` component offers a simple way to add authentication flows into your app. This component encapsulates an authentication workflow in the framework of your choice and is backed by the cloud resources set up in your Auth cloud resources. You’ll also notice the `amplify-sign-out` component. This is an optional component if you’d like to render a sign out button.

```html
<template>
  <amplify-authenticator>
    <div>
      My App
      <amplify-sign-out></amplify-sign-out>
    </div>
  </amplify-authenticator>
</template>
```

</Block>
<Block name="Angular">

First, install the `@aws-amplify/ui-angular` library as well as `aws-amplify` if you have not already:

```bash
npm install aws-amplify @aws-amplify/ui-angular
```

Now open __app.module.ts__ and add the Amplify imports and configuration:

```js
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';;
import { AmplifyAuthenticatorModule } from '@aws-amplify/ui-angular';

import { AppComponent } from './app.component';
import awsconfig from '../aws-exports';

Amplify.configure(awsconfig);

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, AmplifyAuthenticatorModule],
  providers: [],
  bootstrap: [AppComponent],
})
export class AppModule {}
```

Next, import the default theme inside __styles.css__:

```css
@import '~@aws-amplify/ui-angular/theme.css';
````

Next, open __app.component.html__ and add the `amplify-authenticator` component.

**amplify-authenticator**

The `amplify-authenticator` component offers a simple way to add authentication flows into your app. This component encapsulates an authentication workflow in the framework of your choice and is backed by the cloud resources set up in your Auth cloud resources. You’ll also notice that `user` and `signOut` are provided to the inner template.

```html
<amplify-authenticator>
  <ng-template
    amplifySlot="authenticated"
    let-user="user"
    let-signOut="signOut"
  >
    <h1>Welcome {{ user.username }}!</h1>
    <button (click)="signOut()">Sign Out</button>
  </ng-template>
</amplify-authenticator>
```

</Block>
</BlockSwitcher>

#### Option 2: Call Authentication APIs manually with Amplify Libraries

[comment]: # (This section is edited from https://github.com/aws-amplify/docs/blob/main/src/fragments/lib/auth/js/emailpassword.mdx)

You can add the library functionality to enable sign-up, sign-in, and sign-out directly with the Amplify Libraries. You can connect this to an existing UI or create your own.

<BlockSwitcher>
<Block name="Amplify Library Sign-up">

Create a new user in the Amazon Cognito User Pool by passing the new user's email address, password, and other attributes to `Auth.signUp`.

```javascript
import { Auth } from 'aws-amplify';

async function signUp() {
  try {
    const { user } = await Auth.signUp({
      username,
      password,
      attributes: {
        email,          // optional
        phone_number,   // optional - E.164 number convention
        // other custom attributes 
      },
      autoSignIn: { // optional - enables auto sign in after user is confirmed
        enabled: true,
      }
    });
    console.log(user);
  } catch (error) {
    console.log('error signing up:', error);
  }
}
```

##### Confirm sign up

If you enabled multi-factor auth, confirm the sign-up after retrieving a confirmation code from the user.

```js
import { Auth } from 'aws-amplify';

async function confirmSignUp() {
  try {
    await Auth.confirmSignUp(username, code);
  } catch (error) {
    console.log('error confirming sign up', error);
  }
}
```

As part of the options parameter, you can specify the `forceAliasCreation` boolean. By default
set to `True`. If set to `False` and the email or phone number used for sign up confirmation
already exists as an alias for a different user, the API will throw an `AliasExistsException`
error. If set to `True`, the API call will migrate the alias from the previous user to 
a newly created user.

```js
import { Auth } from 'aws-amplify';

async function confirmSignUp() {
  try {
    await Auth.confirmSignUp(username, code, { forceAliasCreation: false });
  } catch (error) {
    console.log('error confirming sign up', error);
  }
}
```

</Block>
<Block name="Amplify Library Sign-in">

When signing in with username and password, you will pass in the username and the password to the `signIn` method of the Auth class.

```javascript
import { Auth } from 'aws-amplify';

async function signIn() {
  try {
    const user = await Auth.signIn(username, password);
  } catch (error) {
    console.log('error signing in', error);
  }
}
```

</Block>
<Block name="Amplify Library Sign-out">

To set up local sign-out you will use the `signOut` method of the Auth class.

```javascript
import { Auth } from 'aws-amplify';

async function signOut() {
  try {
    await Auth.signOut();
  } catch (error) {
    console.log('error signing out: ', error);
  }
}
```

You can sign out end-users from all devices by adding global sign-out. It also invalidates all refresh tokens issued to an end-user. The end-user's current access and Id tokens remain valid until they expire (access and Id tokens expire one hour after they are issued).

```js
import { Auth } from 'aws-amplify';

async function signOut() {
  try {
    await Auth.signOut({ global: true });
  } catch (error) {
    console.log('error signing out: ', error);
  }
}
``` 

</Block>
</BlockSwitcher>

#### Option 3: Use pre-built Hosted UI with Amazon Cognito

The [Cognito Hosted UI]( https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-integration.html#cognito-user-pools-create-an-app-integration) can be set up directly in the console under your Cognito User Pool settings. The default pre-built UI provides you with sign-up and sign-in URLs. You will link your application to these URLs to enable your end-users to sign-up or sign-in directly with Cognito. Once they are authenticated they will be redirected back to your application with the tokens in the URL. There is not a built-in sign-out experience for this UI but you can enable “Sign-out URLs” and send them to your custom built URL. You can learn more about [configuring the Hosted UI]( https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html) in the Amazon Cognito documentation.

### Verify functionality with a test user

You will want to verify everything is functioning with a test user. You can do this using the UI and AWS Console for Cognito or directly with the API.

#### Verify with UI and the AWS Console

You can do this directly from your UI and verify this information by checking your Cognito User Pool in the AWS Console.
1. Start your application (e.g. `npm start` ).
1. Choose “Create Account” on your component or “Sign up” on your sign-in page.
1. Create a test user account.
1. Go to the assigned User Pool in the Amazon Cognito Console and confirm you can see the user under Users. Note that if verification is required their status will be “unconfirmed”. You can also check to make sure any other required attributes are updating correctly.
1. If required, complete the verification via email or phone. This should give you access to your app and you should see the status of the user change to “confirmed” in the Cognito User Pool.
1. You can then test the sign-out functionality with the “Sign-out” button.
1. Try accessing user info or navigating your application and you should first need to sign in again. Credentials have been revoked.

#### Verify with the API

Here is a walkthrough for testing sign-up, sign-in and sign-out using just the Amplify Auth API, without a UI form:
1. Call `Auth.signUp()` to sign up a new test user. Provide a username, password, email and any custom attributes. For example:

    ```js
    Auth.signUp({
      username: 'testUser',
      password: 'myPassword',
      attributes: {
        email: 'test@email.com',
        name: 'Test User'
      }
    }); 
    ```
1. If email verification is enabled for your Cognito User Pool, `Auth.signUp()` will return a "user_cancelled" error. This means a verification email was sent. Your test user will need to verify their email to continue.
1. Once email is verified (or if disabled), call `Auth.currentAuthenticatedUser()` to get the new test user's info. Verify that the:
    1. Correct username, email and attributes were saved
    1. Status is "CONFIRMED" 
    1. Temp AWS credentials and tokens were returned
1. Next, call `Auth.signIn()` and pass the test username and password to sign in the user.

    ```js
    Auth.signIn('testUser', 'myPassword');
    ```
1. If sign-in succeeds, `Auth.signIn()` will return the user's info. Verify that the:
    1. The same test user has signed in 
    1. Their status is still "CONFIRMED"
    1. New AWS credentials and access tokens were issued
1. Finally, call `Auth.signOut()` to sign the test user out.

    ```js 
    Auth.signOut();
    ```
1. After sign-out, `Auth.currentAuthenticatedUser()` should return null. 
1. Try calling Auth methods with the user's credentials or accessing secure APIs - they should now fail or return unauthorized due to the revoked credentials.
1. Call `Auth.signIn()` again with the same test username/password to test you can sign back in and are issued new tokens.

### Recap

You now have enabled sign-up, sign-in, and sign-out for your authentication and verified its functionality with a test user.

[comment]: # (ADD TO RECAP a tie-in to real-world use and application of the topic discussed OR reiterate the benefit. You can delete this comment if this does not apply.)

## Conclusion

Congratulations! You have finished the **Set up Amplify Auth** guide. In this guide, you set up and connect to backend resources; choose your management path; set up and configured your auth category; compared and determined your Auth integration path; enabled sign-up, sign-in, and sign-out and verified they function as expected.

## Next steps

[comment]: # (Provide 2–3 relevant next steps. These can be links related to what was covered in the guide and/or links to related Amplify jobs-to-be-done guides.)
