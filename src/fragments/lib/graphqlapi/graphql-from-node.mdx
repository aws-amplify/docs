You can call an AppSync GraphQL API from a Node.js app or a Lambda function. Take a basic `Todo` app as an example:

```graphql
type Todo @model @auth(rules: [{ allow: public }]) {
  id: ID!
  name: String
  description: String
}
```

This API will have operations available for `create`, `read`, `update`, and `delete`. Let's take a look at how to perform both a **query** as well as a **mutation** from a Lambda function using Node.js.

First, create a Lambda function with `amplify add function` and make sure to give access to your GraphQL API when prompted by the CLI to grant access to other resources in the project.

```console
amplify add function
? Select which capability you want to add: Lambda function (serverless function)
? Provide an AWS Lambda function name: myfunction
? Choose the runtime that you want to use: NodeJS
? Choose the function template that you want to use: Hello World

Available advanced settings:
- Resource access permissions
- Scheduled recurring invocation
- Lambda layers configuration
- Environment variables configuration
- Secret values configuration

? Do you want to configure advanced settings? Yes
? Do you want to access other resources in this project from your Lambda function? Yes
? Select the categories you want this function to have access to. api
? Select the operations you want to permit on <YOUR_API_NAME> Query, Mutation, Subscription

You can access the following resource attributes as environment variables from your Lambda function
	API_<YOUR_API_NAME>_GRAPHQLAPIENDPOINTOUTPUT
	API_<YOUR_API_NAME>_GRAPHQLAPIIDOUTPUT
	API_<YOUR_API_NAME>_GRAPHQLAPIKEYOUTPUT
	ENV
	REGION
```

## Query

<!-- due to placeholder text -->
<!-- prettier-ignore -->
```js
const { Amplify, API } = require('aws-amplify');

const amplifyConfig = {
  aws_appsync_graphqlEndpoint: process.env.API_<your-api-name>_GRAPHQLAPIENDPOINTOUTPUT,
  aws_appsync_authenticationType: 'API_KEY',
  aws_appsync_apiKey: process.env.API_<your-api-name>_GRAPHQLAPIKEYOUTPUT
}

Amplify.configure(amplifyConfig);

const query = /* GraphQL */ `
  query {
    listTodos {
      items {
        id
        name
        description
      }
    }
  }
`;

/**
 * @type {import('@types/aws-lambda').APIGatewayProxyHandler}
 */
exports.handler = async (event) => {
  console.log(`EVENT: ${JSON.stringify(event)}`);
  try {
    return {
      statusCode: 200,
      body: JSON.stringify(await API.graphql({ query }))
    };
  } catch (error) {
    return {
      statusCode: 500,
      body: JSON.stringify(error)
    };
  }
};

```

## Mutation

In this example we create a mutation showing how to pass in variables as arguments.

<!-- due to placeholder text -->
<!-- prettier-ignore -->
```js
const { Amplify, API } = require('aws-amplify');

const amplifyConfig = {
  aws_appsync_graphqlEndpoint: process.env.API_<your-api-name>_GRAPHQLAPIENDPOINTOUTPUT,
  aws_appsync_authenticationType: 'API_KEY',
  aws_appsync_apiKey: process.env.API_<your-api-name>_GRAPHQLAPIKEYOUTPUT
}

Amplify.configure(amplifyConfig);

const query = /* GraphQL */ `
  mutation createTodo($input: CreateTodoInput!) {
    createTodo(input: $input) {
      id
      name
      description
    }
  }
`;

/**
 * @type {import('@types/aws-lambda').APIGatewayProxyHandler}
 */
exports.handler = async (event) => {
  console.log(`EVENT: ${JSON.stringify(event)}`);
  const variables = {
    input: {
      name: 'Hello world!',
      description: 'My first todo'
    }
  };
  try {
    return {
      statusCode: 200,
      body: JSON.stringify(await API.graphql({ query, variables }))
    };
  } catch (error) {
    return {
      statusCode: 500,
      body: JSON.stringify(error)
    };
  }
};
```

## IAM Authorization

Let's take a look at another example schema that uses `iam` authorization.

```graphql
type Todo @model @auth(rules: [{ allow: private, provider: iam }]) {
  id: ID!
  name: String
  description: String
}
```

The CLI will automatically configure the Lambda execution IAM role required by the Lambda function to call the GraphQL API. The following function will sign the request and use environment variables for the AppSync that `amplify add function` created for you.

<!-- due to placeholder text -->
<!-- prettier-ignore -->
```js
const { Amplify, API } = require('aws-amplify');

const amplifyConfig = {
  aws_appsync_graphqlEndpoint: process.env.API_<your-api-name>_GRAPHQLAPIENDPOINTOUTPUT,
  aws_appsync_authenticationType: 'AWS_IAM'
}

Amplify.configure(amplifyConfig);

const query = /* GraphQL */ `
  query {
    listTodosIAM {
      items {
        id
        name
        description
      }
    }
  }
`;

/**
 * @type {import('@types/aws-lambda').APIGatewayProxyHandler}
 */
exports.handler = async (event) => {
  console.log(`EVENT: ${JSON.stringify(event)}`);
  try {
    return {
      statusCode: 200,
      body: JSON.stringify(await API.graphql({ query }))
    };
  } catch (error) {
    return {
      statusCode: 500,
      body: JSON.stringify(error)
    };
  }
};
```
