You can call an AppSync GraphQL API from a Node.js app or a Lambda function. Take a basic `Todo` app as an example:

```graphql
type Todo @model {
  id: ID!
  name: String
  description: String
}
```

This API will have operations available for `create`, `read`, `update`, and `delete`. Let's take a look at how to perform both a **query** as well as a **mutation** from a Lambda function using Node.js.

## Query

```javascript
const axios = require("axios");
const gql = require("graphql-tag");
const graphql = require("graphql");
const {print} = graphql;

const listTodos = gql`
  query listTodos {
    listTodos {
      items {
        id
        name
        description
      }
    }
  }
`;

exports.handler = async (event) => {
  try {
    const graphqlData = await axios({
      url: process.env.API_URL,
      method: "post",
      headers: {
        "x-api-key": process.env.API_ < YOUR_API_NAME > _GRAPHQLAPIKEYOUTPUT,
      },
      data: {
        query: print(listTodos),
      },
    });
    const body = {
      graphqlData: graphqlData.data.data.listTodos,
    };
    return {
      statusCode: 200,
      body: JSON.stringify(body),
      headers: {
        "Access-Control-Allow-Origin": "*",
      },
    };
  } catch (err) {
    console.log("error posting to appsync: ", err);
  }
};
```

## Mutation

In this example we create a mutation showing how to pass in variables as arguments.

```js
const axios = require("axios");
const gql = require("graphql-tag");
const graphql = require("graphql");
const {print} = graphql;

const createTodo = gql`
  mutation createTodo($input: CreateTodoInput!) {
    createTodo(input: $input) {
      id
      name
      description
    }
  }
`;

exports.handler = async (event) => {
  try {
    const graphqlData = await axios({
      url: process.env.API_URL,
      method: "post",
      headers: {
        "x-api-key": process.env.API_ < YOUR_API_NAME > _GRAPHQLAPIKEYOUTPUT,
      },
      data: {
        query: print(createTodo),
        variables: {
          input: {
            name: "Hello world!",
            description: "My first todo",
          },
        },
      },
    });
    const body = {
      message: "successfully created todo!",
    };
    return {
      statusCode: 200,
      body: JSON.stringify(body),
      headers: {
        "Access-Control-Allow-Origin": "*",
      },
    };
  } catch (err) {
    console.log("error creating todo: ", err);
  }
};
```

## Signing a request from Lambda

What about working with custom signing of the request? Let's take a look at another example schema that uses `iam` authorization.

```graphql
type Todo @model @auth(rules: [{allow: private, provider: iam}]) {
  id: ID!
  name: String
  description: String
}
```

Create a Lambda function with `amplify add function` and make sure to give access to your GraphQL API when prompted for in the `amplify add function` flow.

```bash
amplify update function
```

```console
? Select which capability you want to update: Lambda function (serverless function)
? Select the Lambda function you want to update: <YOUR_FUNCTION_NAME>
General information
| Name: <YOUR_FUNCTION_NAME>
| Runtime: nodejs
...

? Which setting do you want to update? Resource access permissions
? Select the categories you want this function to have access to. (Select using <space>)
> api
? Select the operations you want to permit on <YOUR_API_NAME> (Select using <space>)
> Query, Mutation, Subscription

You can access the following resource attributes as environment variables from your Lambda function
	API_<YOUR_API_NAME>_GRAPHQLAPIENDPOINTOUTPUT
	API_<YOUR_API_NAME>_GRAPHQLAPIIDOUTPUT
? Do you want to edit the local lambda function now? No
```

The CLI will automatically configure the Lambda execution IAM role required by the Lambda function to call the GraphQL API. The following function will sign the request and use environment variables for the AppSync and Region that `amplify add function` created for you.

Next, you need to install two npm packages for your AWS Lambda function. To do so, open your terminal in the `amplify/backend/function/<YOUR_FUNCTION_NAME>/src` directory in your newly created AWS Lambda function and run the command `npm install appsync-client graphql-tag`. Once the packages are installed, edit your index.js as the following:

```javascript
const AppSyncClient = require("appsync-client").default;
const gql = require("graphql-tag");
const config = {
  apiUrl: process.env.API_ < YOUR_API_NAME > _GRAPHQLAPIENDPOINTOUTPUT,
};
const client = new AppSyncClient(config);

const {createTodo} = require("./graphql.js");

exports.handler = async (event) => {
  try {
    const item = {
      name: "Lambda Item",
      description: "Item Generated from Lambda",
    };

    const {data} = await client.request({
      query: gql(createTodo),
      variables: {
        input: item,
      },
    });

    return {
      statusCode: 200,
      body: JSON.stringify(data.createTodo),
      headers: {
        "Access-Control-Allow-Origin": "*",
      },
    };
  } catch (error) {
    console.log("Something went wrong in the handler:", error);
  }
};
```

Finally you can define the GraphQL operation you're running, in this case the `createTodo` mutation, in a separate `graphql.js` file:

```javascript
exports.createTodo = /* GraphQL */ `
  mutation createTodo($input: CreateTodoInput!) {
    createTodo(input: $input) {
      id
      name
      description
    }
  }
`;
```
