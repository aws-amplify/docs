## Basic Integration

The Amplify-Flutter Authenticator Widget is a Material-compatible sign-up and sign-in experience which reacts to your Amplify configuration. It automatically detects the authentication state and updates the UI. If the user is signed in, the underlying component (typically your app's home widget) is displayed; otherwise, signin/signup controls are displayed.

To begin, follow the steps for configuring the Amplify Auth category from the [getting started walkthrough](/lib/auth/getting-started). Be sure to also add the Amplify-Flutter Authenticator to your `pubspec.yaml` file:

```yaml
dependencies:
  amplify_authenticator: ^1.0.0-rc.0
```

You will also need to import the Amplify-Flutter Authenticator into your app:

```dart
import 'package:amplify_authenticator/amplify_authenticator.dart';
```

Then, update your main app widget's `build` method:

```dart
@override
Widget build(BuildContext context) {
  return MaterialApp(
    title: 'Authenticator Demo',
    // The Authenticator component should be a descendant of your MaterialApp.
    home: Authenticator(
      child: const Scaffold(
        body: Center(
          child: Text('You are logged in!'),
        ),
      ),
    ),
  );
}
```

If you run your application, you should now see the Amplify-Flutter Authenticator Widget!


![Basic SignIn](/images/flutterAuthenticator/flutter_authenticator_signin_base.png)

## Customizable Forms

Typically, the Amplify-Flutter Authenticator will use your Amplify configuration to determine which inputs are displayed in a form. It also offers the ability to override this default behavior and customize three of its UI forms:

- SignInForm
- SignUpForm
- ConfirmSignInNewPasswordForm

By leveraging this customization, you can control the input fields that are displayed in the form, the validation that is run against the field upon submission and whether or not the field is considered optional.

For example, let's say that you would like to allow (but not force) your users to provide their address. You also want to collect a custom Cognito attribute that you created in your User Pool after your config was generated. Finally, you want to ensure that all usernames include the term 'amplify'.

You can satisfy all three of these requirements by passing a custom signup form:

```dart
String? _validateUsername(UsernameInput? input) {
  final username = input?.username;
  if (username == null || username.isEmpty) {
    return 'Username cannot be empty';
  }
  bool containsAmplify = username.contains('amplify');
  if (!containsAmplify) {
    return 'Username needs to include amplify';
  }
  return null;
}

final authenticator = Authenticator(
  /// Pass a custom SignUpForm to override default fields
  signUpForm: SignUpForm.custom(
    fields: [
      /// Pass a custom validator to the username field
      SignUpFormField.username(
        validator: _validateUsername,
      ),
      /// Mark an attribute as optional
      SignUpFormField.address(
        required: false,
      ),
      /// Create an input for a custom Cognito attribute
      SignUpFormField.custom(
        title: 'Favorite Food',
        attributeKey: const CognitoUserAttributeKey.custom(
          'favoritefood',
        )),
      ],
    ),
    child: const Scaffold(
      body: Center(
        child: Text('You are logged in!'),
      ),
    ),
);
```

Run your app, and you will see the updated fields reflected in the Sign Up screen:

![Custom SignUp](/images/flutterAuthenticator/flutter_authenticator_signup_custom.png)


## Theming/Styling

By default, the Amplify-Flutter Authenticator uses your app's Material theme for its styling. Any customizations you make to colors, buttons, input widgets, etc. will be reflected in the Authenticator.

```dart
return MaterialApp(
  title: 'Authenticator Demo',
  theme: ThemeData.from(
    colorScheme: ColorScheme.fromSwatch(
      primarySwatch: Colors.red,
      backgroundColor: Colors.white,
    ),
  ).copyWith(
    indicatorColor: Colors.red,
  ),
  darkTheme: ThemeData.from(
    colorScheme: ColorScheme.fromSwatch(
      primarySwatch: Colors.red,
      backgroundColor: Colors.black,
      brightness: Brightness.dark,
    ),
  ),
  home: authenticator,
);

```

Reload your app, and you should see a red theme, which can also adjust to device dark mode.

![Custom Theme](/images/flutterAuthenticator/flutter_authenticator_red_theme.png)
![Custom Theme Dark](/images/flutterAuthenticator/flutter_authenticator_red_theme_dark.png)

Additionally, you can also use the a hand-crafted Amplify theme by setting useAmplifyTheme to true. This gives you a starting theme which is unique from the default Material theme.

```dart
return MaterialApp(
  title: 'Authenticator Demo',
  theme: ThemeData.light(),
  darkTheme: ThemeData.dark(),
  home: Authenticator(
    useAmplifyTheme: true,
    child: const Scaffold(
      body: Center(
        child: Text('You are logged in!'),
      ),
    ),
  ),
);
```

![AmplifyTheme](/images/flutterAuthenticator/flutter_authenticator_amplify_theme.png)
![AmplifyTheme Dark](/images/flutterAuthenticator/flutter_authenticator_amplify_theme_dark.png)

## Text Overrides and Localization

Most of the text displayed in the Amplify-Flutter Authenticator is customizable and compatible with Flutter's out-of-the-box localization APIs. To customize text you can pass an `AuthStringResolver` class to the Authenticator API which dictates the text displayed within the widgets. This class is composed of five different subclasses, each controlling what is displayed in the Authenticator for different types of text.

* **ButtonResolver**: The text displayed within buttons;
* **CountryResolver**: The displayed country names when selecting a dial code for phone numbers;
* **InputResolver**: The text displayed within input fields, including input titles, hints and various validation messages;
* **TitleResolver**: The titles of widgets;
* **MessageResolver**: Various messages displayed to the user, such as the message informing a user that a verification email has been sent.

The attributes available within each of these resolvers is documented in source code and should be available via your IDE.

<Callout warning={true}>

The Amplify-Flutter Authenticator does not yet support localization of error messages received from the Cognito service and client libraries.

</Callout>


#### Simple text customization

It is not necessary to do full fledged localization to customize components within the Amplify-Flutter Authenticator. 

For example, consider the case where you would like to customize *only* the text within the 'Sign In' button and the titles of the username, email and password fields:

```dart
/// Instantiate a ButtonResolver
class CustomButtonResolver extends ButtonResolver {
  const CustomButtonResolver();

  /// Override the signin function
  @override
  String signin(BuildContext context) {
    //the text of the signin button can be customized
    return 'Login to Amplify';
  }
}

/// Instantiate an InputResolver
class CustomInputResolver extends InputResolver {
  const CustomInputResolver();

  /// Override the title function
  /// Since this function handles the title for numerous fields,
  /// we recommend using a switch statement so that `super` can be called
  /// in the default case.
  @override
  String title(BuildContext context, InputField field) {
    switch (field) {
      case InputField.username:
        return 'Custom Username Title';
      case InputField.email:
        return 'Custom Email Title';
      case InputField.password:
        return 'Custom Password Title';
      case InputField.passwordConfirmation:
        return 'Custom Password Confirmation Title';
      default:
        return super.title(context, field);
    }
  }
}

/// Instantiate an AuthStringResolver with your two custom resolvers
const stringResolver = AuthStringResolver(
  buttons: CustomButtonResolver(),
  inputs: CustomInputResolver(),
);

/// Pass the string resolver to the Authenticator API
final authenticator = Authenticator(
  stringResolver: stringResolver,
  child: const Scaffold(
    body: Center(
      child: Text('You are logged in!'),
    ),
  ),
);
```

![Custom Text Sign In](/images/flutterAuthenticator/flutter_authenticator_custom_text_signin.png)
![Custom Text Sign Up](/images/flutterAuthenticator/flutter_authenticator_custom_text_signup.png)


#### Setting up localization

In addition to the static customization detailed above, you can also fully localize the Amplify-Flutter Authenticator so that it responds to the device locale.

To use true localization, you should carefully follow the steps in the [Flutter Localization guide](https://flutter.dev/docs/development/accessibility-and-localization/internationalization). When the guide says to create an .arb file, enter the following into `lib/l10n/amplify_en.arb`:

```json
{
    "signin": "Sign In - Localized!",
    "@signin": {
        "description": "Label of the button to sign in the user."
    }
}
```

Then, to add Spanish support, create another file at `lib/l10n/amplify_es.arb`, and add the following:

```json
{
    "signin": "Iniciar Sesión"
}
```

As you can see, this example only updates the 'Sign In' button. To find the full schema for Authenticator-compatible `.arb` file(s), you can check the default `.arb` files that come packaged with the Amplify-Flutter Authenticator in the [`/src/l10n/src/`](https://github.com/aws-amplify/amplify-flutter/tree/release-candidate/packages/amplify_authenticator/lib/src/l10n/src) directory.

Import the following in the `./lib/main.dart` file:

```dart
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:flutter_gen/gen_l10n/app_localizations.dart';
```

You should then create a `ButtonResolver` and pass it to an `AuthStringResolver`, and in turn pass this to the Authenticator API:

```dart
class LocalizedButtonResolver extends ButtonResolver {
  const LocalizedButtonResolver();

  /// Override the signin function with a localized value
  @override
  String signin(BuildContext context) {
    return AppLocalizations.of(context).signin;
  }
}

const stringResolver = AuthStringResolver(
  buttons: LocalizedButtonResolver(),
);

final authenticator = Authenticator(
  stringResolver: stringResolver,
  child: const Scaffold(
    body: Center(
      child: Text('You are logged in!'),
    ),
  ),
);


```

Then, update your MaterialApp:

```dart
return MaterialApp(
  title: 'Authenticator Demo',
  theme: ThemeData.light(),
  darkTheme: ThemeData.dark(),
  localizationsDelegates: const [
    AppLocalizations.delegate,
  ],
  supportedLocales: const [
    Locale('en'), // English
    Locale('es'), // Spanish
  ],
  home: authenticator,
);
```

There may be some analysis exceptions in your IDE because, as the Flutter instructions note, Flutter will automatically generate the files at build time. You may need to enable automatic code generation by setting `generate: true` in your app's `pubspec.yaml` file. 

Your device, assuming it is set to English, should display 'Sign In - Localized' as the Sign In button text. If you change your device language to Spanish, you should see 'Iniciar Sesión'.

![English Text Sign In](/images/flutterAuthenticator/flutter_authenticator_english.png)
![Spanish Text Sign Up](/images/flutterAuthenticator/flutter_authenticator_spanish.png)

## Under the Hood

The  Amplify-Flutter Authenticator responds to values from your Amplify configuration. This is typically created by the Amplify CLI, but may also be hand written. The keys that are relevant for the Authenticator UI are contained under `auth.plugins.awsCognitoAuthPlugin.Auth.Default`.

* **socialProviders**: A list which determines the third party authentication providers for Cognito Hosted UI. Possible values include `AMAZON`, `APPLE`, `FACEBOOK` and `GOOGLE`.

* **usernameAttributes**: A list which determines whether users can signup with an email and/or phone number as their username; an empty list denotes a plain text username. Possible values include `EMAIL` and `PHONE_NUMBER`.

* **signupAttributes**: A list which determines the required attributes that are displayed on the Sign Up form. Possible values include `ADDRESS`, `BIRTHDATE`, `EMAIL`, `FAMILY_NAME`, `GENDER`, `GIVEN_NAME`, `MIDDLE_NAME`, `NAME`, `NICKNAME`, `PHONE_NUMBER` and `PREFERRED_USERNAME`.

* **passwordProtectionSettings.passwordPolicyMinLength**: A number which determines the length of the users password required by client-side validation. Value must be greater than 5 and less than 99.

* **passwordProtectionSettings.passwordPolicyCharacters**: A list which determines the password character requirements imposed by client-side validation. Possible values include `REQUIRES_LOWERCASE`, `REQUIRES_NUMBERS`, `REQUIRES_SYMBOLS` and `REQUIRES_UPPERCASE`.

* **verificationMechanisms**: A list of the attributes the user will be asked to verify. Possible values include `EMAIL` and `PHONE_NUMBER`.