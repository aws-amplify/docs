The next feature you will be adding is authentication.

## Authentication with Amplify

Amplify uses [Amazon Cognito](https://aws.amazon.com/cognito/) as the main authentication provider. Amazon Cognito is a robust user directory service that handles user registration, authentication, account recovery & other operations. In this tutorial, you'll learn how to add authentication to your application using Amazon Cognito and username/password login.

## Create authentication service

To add authentication to your app, run this command:

```bash
amplify add auth
```

Select the defaults for the following prompts:

```console
? Do you want to use the default authentication and security configuration? Default configuration
Warning: you will not be able to edit these selections. 
? How do you want users to be able to sign in? Username
? Do you want to configure advanced settings? No, I am done.
```

To deploy the service, run the `push` command:

```bash
amplify push
```

Now, the authentication service has been deployed and you can start using it. To view the deployed services in your project at any time, go to Amplify Console by running the following command:

```bash
amplify console
```

## Create login UI

Creating a login flow can be quite difficult and time consuming to get right. Luckily, Amplify UI has an [authentication](https://ui.docs.amplify.aws/react-native/connected-components/authenticator) component that provides an entire authentication flow for you, using the configuration you specified in **aws-exports.js.**

### Install Amplify UI

The `@aws-amplify/ui-react-native` package includes React Native specific UI components you'll use to build your app. Install it with this:

```bash
npm i @aws-amplify/ui-react-native aws-amplify react-native-safe-area-context amazon-cognito-identity-js @react-native-community/netinfo @react-native-async-storage/async-storage react-native-get-random-values react-native-url-polyfill
```

### Add the Amplify UI Authenticator component

<BlockSwitcher>
<Block name="Expo CLI">

The `@aws-amplify/ui-react` package will be used for the `Expo web` React version.

```
npm i @aws-amplify/ui-react aws-amplify

```

Add [platform specific files](https://reactnative.dev/docs/platform-specific-code#native-specific-extensions-ie-sharing-code-with-nodejs-and-web) to support both native and web:

**Auth.js**

```jsx
// Re-export for web platform
export { withAuthenticator, useAuthenticator } from '@aws-amplify/ui-react';
```

**Auth.native.js**

```jsx
// Re-export for native platform
export { withAuthenticator, useAuthenticator } from '@aws-amplify/ui-react-native';
```

**AuthStyles.js**

```jsx
// Import styles for web platform
import '@aws-amplify/ui-react/styles.css';
```
**AuthStyle.native.js**

```jsx
// Import styles for native platform
// Empty file - no need to import anything.
```

Open **App.js** and make the following changes:

1. Import the `withAuthenticator` component and `useAuthenticator` hook:

```javascript

import { withAuthenticator, useAuthenticator } from './Auth';
import './AuthStyles';

```

</Block>
<Block name="React Native CLI">

Open **App.ts** and make the following changes:

1. Import the `withAuthenticator` component and `useAuthenticator` hook:

```javascript

import { Authenticator, useAuthenticator } from '@aws-amplify/ui-react-native';

````

</Block>
</BlockSwitcher>


2. Pass `{signOut, user}` to the any component where you need it (e.g. `SignOutButton`):

```javascript

const SignOutButton = () => {
  const { user, signOut } = useAuthenticator((context) => [context.user]);
  return (
    <Pressable onPress={signOut} style={styles.buttonContainer}>
      <Text style={styles.buttonText}>Hello, {user.username}! Click here to sign out!</Text>
    </Pressable>
  )
};

```

3. Add `SignOutButton` component to  your `App` component:

```javascript

// ...
return (
    <View style={styles.container}>
      <StatusBar hidden/>
      <SignOutButton />
//...

```

4. Lastly, wrap your `App` export with the `withAuthenticator` Amplify UI component:

```javascript

export default withAuthenticator(App);

```

Run the app to see the new authentication flow protecting the app:

```bash
npm start
```

Now you should see the app load with an authentication flow allowing users to sign up and sign in. Here's all the code below:

<BlockSwitcher>
<Block name="Expo CLI">

```javascript
import React, { useEffect, useState } from 'react'
import { StatusBar } from 'expo-status-bar';
import { StyleSheet, Text, View, TextInput, Pressable } from 'react-native';
import { API, graphqlOperation } from 'aws-amplify'
import { createTodo } from './src/graphql/mutations'
import { listTodos } from './src/graphql/queries'
import { withAuthenticator, useAuthenticator } from './Auth';
import './AuthStyles';

const SignOutButton = () => {
  const { user, signOut } = useAuthenticator((context) => [context.user]);
  return (
    <Pressable onPress={signOut} style={styles.buttonContainer}>
      <Text style={styles.buttonText}>Hello, {user.username}! Click here to sign out!</Text>
    </Pressable>
  )
};

const initialState = { name: '', description: '' }

const App = () => {
  const [formState, setFormState] = useState(initialState)
  const [todos, setTodos] = useState([])

  useEffect(() => {
    fetchTodos()
  }, [])

  function setInput(key, value) {
    setFormState({ ...formState, [key]: value })
  }

  async function fetchTodos() {
    try {
      const todoData = await API.graphql(graphqlOperation(listTodos))
      const todos = todoData.data.listTodos.items
      setTodos(todos)
    } catch (err) { console.log('error fetching todos') }
  }

  async function addTodo() {
    try {
      if (!formState.name || !formState.description) return
      const todo = { ...formState }
      setTodos([...todos, todo])
      setFormState(initialState)
      await API.graphql(graphqlOperation(createTodo, {input: todo}))
    } catch (err) {
      console.log('error creating todo:', err)
    }
  }

  return (
    <View style={styles.container}>
      <StatusBar hidden/>
      <SignOutButton />
      <TextInput
        onChangeText={value => setInput('name', value)}
        style={styles.input}
        value={formState.name}
        placeholder="Name"
      />
      <TextInput
        onChangeText={value => setInput('description', value)}
        style={styles.input}
        value={formState.description}
        placeholder="Description"
      />
      <Pressable onPress={addTodo} style={styles.buttonContainer}>
        <Text style={styles.buttonText}>Create todo</Text>
      </Pressable>
      {
        todos.map((todo, index) => (
          <View key={todo.id ? todo.id : index} style={styles.todo}>
            <Text style={styles.todoName}>{todo.name}</Text>
            <Text style={styles.todoDescription}>{todo.description}</Text>
          </View>
        ))
      }
    </View>
  );
}

export default withAuthenticator(App)

const styles = StyleSheet.create({
  container: { width: 400, flex: 1, padding: 20, alignSelf: 'center' },
  todo: {  marginBottom: 15 },
  input: { border: 'none', backgroundColor: '#ddd', marginBottom: 10, padding: 8, fontSize: 18 },
  todoName: { fontSize: 20, fontWeight: 'bold' },
  todoDescription: { marginBottom: 0 },
  buttonContainer: { alignSelf: 'center', backgroundColor: 'black',  paddingHorizontal: 8 },
  buttonText: { color: 'white', padding: 16, fontSize: 18 },
});
```

</Block>
<Block name="React Native CLI">

```javascript
import React, { useEffect, useState } from 'react'
import { StatusBar } from 'expo-status-bar';
import { StyleSheet, Text, View, TextInput, Pressable } from 'react-native';
import { API, graphqlOperation } from 'aws-amplify'
import { createTodo } from './src/graphql/mutations'
import { listTodos } from './src/graphql/queries'
import { withAuthenticator, useAuthenticator } from '@aws-amplify/ui-react-native';

const SignOutButton = () => {
  const { user, signOut } = useAuthenticator((context) => [context.user]);
  return (
    <Pressable onPress={signOut} style={styles.buttonContainer}>
      <Text style={styles.buttonText}>Hello, {user.username}! Click here to sign out!</Text>
    </Pressable>
  )
};

const initialState = { name: '', description: '' }

const App = () => {
  const [formState, setFormState] = useState(initialState)
  const [todos, setTodos] = useState([])

  useEffect(() => {
    fetchTodos()
  }, [])

  function setInput(key, value) {
    setFormState({ ...formState, [key]: value })
  }

  async function fetchTodos() {
    try {
      const todoData = await API.graphql(graphqlOperation(listTodos))
      const todos = todoData.data.listTodos.items
      setTodos(todos)
    } catch (err) { console.log('error fetching todos') }
  }

  async function addTodo() {
    try {
      if (!formState.name || !formState.description) return
      const todo = { ...formState }
      setTodos([...todos, todo])
      setFormState(initialState)
      await API.graphql(graphqlOperation(createTodo, {input: todo}))
    } catch (err) {
      console.log('error creating todo:', err)
    }
  }

  return (
    <View style={styles.container}>
      <StatusBar hidden/>
      <SignOutButton />
      <TextInput
        onChangeText={value => setInput('name', value)}
        style={styles.input}
        value={formState.name}
        placeholder="Name"
      />
      <TextInput
        onChangeText={value => setInput('description', value)}
        style={styles.input}
        value={formState.description}
        placeholder="Description"
      />
      <Pressable onPress={addTodo} style={styles.buttonContainer}>
        <Text style={styles.buttonText}>Create todo</Text>
      </Pressable>
      {
        todos.map((todo, index) => (
          <View key={todo.id ? todo.id : index} style={styles.todo}>
            <Text style={styles.todoName}>{todo.name}</Text>
            <Text style={styles.todoDescription}>{todo.description}</Text>
          </View>
        ))
      }
    </View>
  );
}

export default withAuthenticator(App)

const styles = StyleSheet.create({
  container: { width: 400, flex: 1, padding: 20, alignSelf: 'center' },
  todo: {  marginBottom: 15 },
  input: { border: 'none', backgroundColor: '#ddd', marginBottom: 10, padding: 8, fontSize: 18 },
  todoName: { fontSize: 20, fontWeight: 'bold' },
  todoDescription: { marginBottom: 0 },
  buttonContainer: { alignSelf: 'center', backgroundColor: 'black',  paddingHorizontal: 8 },
  buttonText: { color: 'white', padding: 16, fontSize: 18 },
});
```

</Block>
</BlockSwitcher>
