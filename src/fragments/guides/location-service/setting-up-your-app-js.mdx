[Amazon Location Service](https://aws.amazon.com/location/) is a new geolocation service that lets you add location information to your applications. With Amazon Location Service, you can build applications that provide maps and points of interest. You can also track resources, trigger actions based on location, and convert street addresses into geographic coordinates.  

This tutorial topic outlines how to set up your app to use Amazon Location Service. To learn more about the service, see the [Amazon Location Service Developer Guide](https://docs.aws.amazon.com/location/latest/developerguide/).

## Overview

In this tutorial, we’ll do the following:

* Create a new React app as the base for this tutorial.
* Use the AWS SDK JavaScript v2 package for the Amazon Location Service SDK calls.
* Set up a base configuration for Amplify with Authentication.
* Connect your React app to the Amazon Location Service.
* Use the Amazon Location Service APIs to search for places.

### Creating a new React app

First, we’ll create and start a new React app with [create-react-app](https://reactjs.org/docs/create-a-new-react-app.html), a CLI tool used to bootstrap a React app using current best practices. We’ll then add Amplify and initialize a new project. The following procedure will walk you through this process.

**To create a new React app**

1. From your projects directory, run the following commands:

```bash
npx create-react-app amazon-location-service-places
cd amazon-location-service-places
```

This creates a new React app in a directory called `amazon-location-service-places` and moves into that new directory.

2. Now that you’re in the root directory of the project, run the app with the `npm start` command. This command also runs a development server so you can see the output generated by the build by navigating to `http://localhost:3000`.

You have now successfully created and started your new React app.

## Installing SDK dependencies

The first step to using the SDKs in the client is to install the necessary dependencies with the following command:

```bash
npm install aws-sdk aws-amplify
```

## Adding authentication

The next feature you will be adding to your React app is authentication. The Amplify Framework uses [Amazon Cognito](https://aws.amazon.com/cognito/) as the main authentication provider. Amazon Cognito is a robust user directory service that handles user registration, authentication, account recovery & other operations. 

In the following procedure, you’ll add authentication to your React app using Amazon Cognito and support for username/password logins.

**To add authentication to your React app**

1. From your projects directory, run the following command, and answer the prompted questions as indicated.

```bash
amplify add auth

? Do you want to use the default authentication and security configuration? Default configuration
? How do you want users to be able to sign in? Username
? Do you want to configure advanced settings?  No, I am done.
```

2. Deploy the service by running the `amplify push` command.

## Connecting your React app to the Amazon Location Service

In the following procedure, you’ll connect your React app to the Amazon Location Service APIs.

**To connect your React app to the Amazon Location Service**

Open your `src/App.js` file, and call the following function to initialize the Amazon Location Service client:

```javascript
import Amplify, { Auth } from 'aws-amplify';
import Location from "aws-sdk/clients/location";
import awsconfig from './aws-exports';

Amplify.configure(awsconfig);

const createClient = async () => {
    const credentials = await Auth.currentCredentials();
    const client = new Location({
        credentials,
        region: awsconfig.aws_project_region,
   });
   return client;
}
```

You’ve now successfully connected your React app to the Amazon Location Service.

## Using the Amazon Location Service APIs

In order to access Amazon Location Service APIs you will need to create resources. You can create resources using the [Amazon Location Service console](http://console.aws.amazon.com/location/home) or using the [AWS Command Line Interface (CLI)](https://aws.amazon.com/cli/). Once you have created the resources, you can use these resources by calling the APIs.

This section provides you an example of using the Amazon Location Service APIs. In this example, we will first create a Place Index in the Amazon Location Service console and use the APIs to search for places.  

### Creating a new place index

1. Open the [Amazon Location Service console](https://console.aws.amazon.com/location/places/home#/create) to create a place index.
2. Enter **MyPlaceIndex** in **Name**.
3. Press **Create place index**

![Amazon Location Service - Create place index](/images/als/create-place-index.png)

4. Note the Amazon Resource Name (ARN) of your place index. This will start with **arn:aws:geo** as in the below screenshot.

![Amazon Location Service - Place index](/images/als/my-place-index.png)

### Allow Guest users access to the place index

Now that you have created a Place Index resource, you must create an inline policy to give users of your application access to the resource:

1. Navigate to the root of your project and run the following command:
```bash
amplify console auth
```

1. Select `Identity Pool` for Which console? when prompted.
2. You will be directed to the Amazon Cognito console. Click on `Edit` identity pool in the top right corner of the page.
3. Open the drop down for `Unauthenticated identities`,  choose `Enable` access to unauthenticated identities, and then press `Save` Changes.
4. Click on `Edit` identity pool once more. Make a note of the name of the `Unauthenticated` role. For example, `amplify-<project_name>-<env_name>-<id>-unauthRole`.
5. Open the [AWS Identity and Access Management (IAM) console](https://console.aws.amazon.com/iam/home#/roles) to manage Roles.
6. In the *Search* field, enter the name of your Unauthenticated role noted above and click on it.
7. Click *+Add inline policy*, then click on the *JSON* tab.
8. Fill in the *[ARN]* placeholder with the ARN of your place index which you noted above and replace the contents of the policy with the below.

```bash
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "geo:SearchPlaceIndexForText",
            "Resource": "[ARN]"
        }
    ]
}
```

10. Click on the Review policy button.
11. In the Name field, enter `LocationTracker`.
12. Click on the Create policy button. You have now successfully added authentication to your React app.

### Searching for places

The following code details how to use the Amazon Location Service APIs to search for places using the Place Index you just created: 

```javascript
const params = {
  IndexName: "MyPlaceIndex",
  Text: "Indianapolis",
};
client.searchPlaceIndexForText(params, (err, data) => {
  if (err) console.error(err);
  if (data) console.log(data);
});
```

