## Model Generation

The first step towards integrating DataStore into your app is to model your data. To do so, you'll define a GraphQL schema. Amplify will then *generate Java classes* from that schema. The same schema may be used to generate models across Android, iOS, and JavaScript, and is used by DataStore's network protocol when synchronizing data with the cloud.  Models can be generated by running a Gradle task in Android Studio, or by executing a command with the Amplify CLI.

## Using Gradle

Open your project `build.gradle` and add `mavenCentral()` as a repository, `classpath 'com.amplifyframework:amplify-tools-gradle-plugin:0.2.1'` as a dependency, and `'com.amplifyframework.amplifytools'` as a plugin:

```groovy
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.6.2'
        classpath 'com.amplifyframework:amplify-tools-gradle-plugin:0.2.1'
    }
}

apply plugin: 'com.amplifyframework.amplifytools'
```

Next, add the following dependencies to your app `build.gradle`:

```groovy
implementation 'com.amplifyframework:core:0.10.0'
implementation 'com.amplifyframework:aws-api:0.10.0' // If using cloud sync
implementation 'com.amplifyframework:aws-datastore:0.10.0'
```

Sync the project and ensure that it built successfully. Switch to the **Project** view in Android Studio and open the schema file at `amplify/backend/api/amplifyDatasource/schema.graphql`. For this guide, edit this file so that it contains the schema definition below.  [Learn more](https://docs.amplify.aws/cli/graphql-transformer/overview) about annotating GraphQL schemas and data modeling.

```graphql
enum PostStatus {
  ACTIVE
  INACTIVE
}

type Post @model {
  id: ID!
  title: String!
  rating: Int!
  status: PostStatus!
}
```

Gradle tasks will generate model files to be used in your API calls, and will provision a backend for you.

After saving your `schema.graphql` file, click the Gradle Task dropdown in the toolbar and select **modelgen** and run the task. Once it completes you should have generated Java classes under `app/src/main/java/com/amplifyframework/datastore/generated/model`.

<amplify-callout>

You do not need an AWS account to complete these steps, nor if you are using DataStore without a backend. However, if you wish to sync with the cloud, it is recommended that you [Install and configure the Amplify CLI](../../../start/getting-started/installation.md)

</amplify-callout>

## Manual Model Generation

If you do not wish to use the above Gradle task, you can perform the same steps manually. First, install the latest version of the Amplify CLI:

```
npm i -g @aws-amplify/cli@latest
```

Generate models at any time by executing this Amplify CLI command:

```
amplify codegen models
```

### Schema updates

When the code generator builds model classes for your schema, it also generates a version hash based on the current schema. When you make changes to your schema and re-run the modelgen task, the code generator will update the hash if it detects any changes that will impact the underlying on-device storage structure. For example, a new hash will be generated if data types are added/deleted, or if any field has a change to its required/optional status.

Whenever DataStore starts on a device, it will check for a change in the version hash. If the version has changed, all instances of these models will be wiped from the device, and if you are syncing with the cloud, a full sync will take place. Local migrations on device are not supported.  If you are syncing with the cloud, the existing structure and instances of your data in the backend will not be modified as part of this process.

## Setup frontend

In your app's `onCreate` (or similar lifecycle callback), initialize Amplify:

```java
AWSDataStorePlugin dataStorePlugin = AWSDataStorePlugin.forModels(AmplifyModelProvider.getInstance());
Amplify.addPlugin(dataStorePlugin);
Amplify.addPlugin(new AWSApiPlugin()); // If using remote model synchronization
Amplify.configure(getApplicationContext());
```

If you do not have any configuration file at `app/src/main/res/raw/amplifyconfiguration.json`, create a placeholder for now. For more information about this file, see the configuration section of this guide.

```
{
  "userAgent": "aws-amplify-cli/2.0",
  "version": "1.0"
}
```

## API Reference   

For the complete API documentation for DataStore, visit our [API Reference](https://docs.amplify.aws/lib/getting-started/setup?platform=android).

